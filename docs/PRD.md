# 📋 PRD (Product Requirements Document)

## 싸인해주세요 (SignPlease)

> **버전**: 1.27  
> **최종 수정일**: 2026년 2월 9일  
> **작성자**: PM

---

## 1. Project Overview (프로젝트 개요)

### 1.1 서비스 정의

**싸인해주세요**는 식당/카페 사장님과 아르바이트생을 위한 **AI 노무사 검토 기능이 탑재된 표준근로계약서 작성 및 전자서명 서비스**입니다.

### 1.2 문제 정의 (Problem Statement)

| 문제                 | 현재 상황                                  | 목표 상태                            |
| -------------------- | ------------------------------------------ | ------------------------------------ |
| 계약서 작성의 어려움 | 사장님들이 근로기준법을 모르고 수기로 작성 | 10분 내 법적 요건을 갖춘 계약서 완성 |
| 서면 계약서 보관     | 종이 계약서 분실, 훼손 위험                | 클라우드 영구 보관 및 즉시 조회      |
| 법률 검토 비용       | 노무사 상담 비용 부담 (건당 5-10만원)      | AI로 저렴하게 법률 검토 제공         |
| 알바생 정보 관리     | 매번 주민번호, 계좌번호 수기 요청          | 최초 1회 입력 후 자동 전달           |

### 1.3 핵심 목표 (Key Objectives)

1. **간편함**: Step-by-Step UI로 누구나 쉽게 계약서 작성
2. **합법성**: 2026년 근로기준법 기준 표준계약서 양식 제공
3. **효율성**: 전자서명으로 대면 없이 계약 완료
4. **신뢰성**: AI 노무사의 법률 검토로 분쟁 예방

### 1.4 플랫폼

- **모바일 웹 (PWA)**: 별도 앱 설치 없이 브라우저에서 사용
- **기본 뷰포트**: max-width 448px (모바일 퍼스트)

---

## 2. Target Audience (타겟 사용자)

### 2.1 주요 사용자 페르소나

#### 👔 사업자 (Employer) - "김사장님"

| 항목           | 내용                                                   |
| -------------- | ------------------------------------------------------ |
| **나이/직업**  | 45세, 동네 카페 운영 3년차                             |
| **특징**       | 스마트폰은 능숙하나 법률/문서 작업에 어려움            |
| **Pain Point** | "계약서 쓸 때마다 인터넷 검색하는데 맞는지 모르겠어요" |
| **Goal**       | 빠르고 정확하게 계약서 쓰고 카톡으로 보내고 싶음       |

#### 👷 근로자 (Worker) - "이알바"

| 항목           | 내용                                                    |
| -------------- | ------------------------------------------------------- |
| **나이/직업**  | 22세, 대학생 아르바이트                                 |
| **특징**       | 모바일 네이티브, 앱 설치 꺼림                           |
| **Pain Point** | "계약서 용어가 어렵고, 매번 주민번호 불러주기 귀찮아요" |
| **Goal**       | 간편하게 서명하고 내 경력 관리하고 싶음                 |

### 2.2 사용자 규모 예상

- **1차 타겟**: 수도권 소규모 요식업 사업장 (5인 미만)
- **2차 타겟**: 전국 소규모 사업장 (5인 이상 포함)

---

## 3. User Stories (사용자 스토리)

### 3.1 사업자 (Employer) 스토리

| ID   | 스토리                                                                                  | 우선순위 |
| ---- | --------------------------------------------------------------------------------------- | -------- |
| E-01 | 사장님으로서, 새로운 알바생과 계약하기 위해 **표준근로계약서를 작성**할 수 있다         | P0       |
| E-02 | 사장님으로서, 작성한 계약서를 **카카오톡으로 알바생에게 전송**할 수 있다                | P0       |
| E-03 | 사장님으로서, 작성한 계약서가 법적으로 문제없는지 **AI 노무사에게 검토 요청**할 수 있다 | P0       |
| E-04 | 사장님으로서, 내가 작성한 모든 계약서를 **대시보드에서 한눈에 확인**할 수 있다          | P0       |
| E-05 | 사장님으로서, 계약서를 **폴더별로 분류하여 관리**할 수 있다                             | P1       |
| E-06 | 사장님으로서, 알바생이 서명을 완료하면 **알림톡으로 알림**을 받을 수 있다               | P1       |
| E-07 | 사장님으로서, 완료된 계약서를 **PDF로 다운로드**할 수 있다                              | P0       |
| E-08 | 사장님으로서, 알바생과 계약 조건에 대해 **1:1 채팅**을 할 수 있다                       | P1       |
| E-09 | 사장님으로서, 계약서 작성을 위한 **크레딧을 구매**할 수 있다                            | P0       |
| E-10 | 사장님으로서, 기존 계약서를 **수정하고 재서명을 요청**할 수 있다                        | P1       |

### 3.2 근로자 (Worker) 스토리

| ID   | 스토리                                                                                      | 우선순위 |
| ---- | ------------------------------------------------------------------------------------------- | -------- |
| W-01 | 알바생으로서, 카카오톡으로 받은 계약서 링크를 통해 **계약 내용을 확인**할 수 있다           | P0       |
| W-02 | 알바생으로서, 계약서의 어려운 용어를 터치하면 **AI가 쉽게 설명**해준다                      | P0       |
| W-03 | 알바생으로서, 계약 조건에 동의하면 **전자서명**을 할 수 있다                                | P0       |
| W-04 | 알바생으로서, 최초 1회 **주민번호, 계좌번호, 휴대폰 인증**을 하면 이후 계약에 자동 적용된다 | P0       |
| W-05 | 알바생으로서, 서명한 모든 계약서를 **대시보드에서 관리**할 수 있다                          | P0       |
| W-06 | 알바생으로서, 완료된 계약을 바탕으로 **경력증명서를 다운로드**할 수 있다                    | P1       |
| W-07 | 알바생으로서, 계약 조건에 대해 사장님과 **1:1 채팅**을 할 수 있다                           | P1       |
| W-08 | 알바생으로서, 서명 완료된 계약서를 **PDF로 다운로드**할 수 있다                             | P0       |

---

## 4. Functional Requirements (기능 요구사항)

### 4.1 인증 및 온보딩

#### 4.1.1 스플래시 화면 (`/`)

| 항목          | 설명                                       |
| ------------- | ------------------------------------------ |
| **목적**      | 앱 로딩 및 브랜드 인지                     |
| **표시 요소** | 로고, 서비스명 "싸인해주세요"              |
| **동작**      | 2초 후 자동으로 다음 화면 이동             |
| **분기 조건** | 로그인 상태 → 대시보드 / 비로그인 → 온보딩 |

#### 4.1.2 온보딩 (`/onboarding`)

| 항목              | 설명                                                     |
| ----------------- | -------------------------------------------------------- |
| **목적**          | 서비스 가치 전달 및 가입 유도                            |
| **화면 수**       | 3장 슬라이드 (스와이프로 이동)                           |
| **슬라이드 내용** | 1) 간편한 계약서 작성 2) AI 법률 검토 3) 전자서명 & 보관 |
| **버튼 (메인)**   | "시작하기" → 회원가입 화면 이동                          |
| **버튼 (서브)**   | "둘러보기" → 게스트 모드로 체험                          |
| **스킵**          | "건너뛰기" 텍스트 버튼                                   |

#### 4.1.2-1 둘러보기 (게스트 모드)

| 항목               | 설명                                                |
| ------------------ | --------------------------------------------------- |
| **목적**           | 회원가입 없이 서비스 주요 기능 체험                 |
| **진입 경로**      | 온보딩 화면의 "둘러보기" 버튼 클릭                  |
| **역할 선택**      | 사장님/알바생 중 체험할 역할 선택                   |
| **체험 가능 기능** | 아래 표 참조                                        |
| **제한 기능**      | 실제 계약서 저장, 전송, 결제, 채팅 불가             |
| **회원가입 유도**  | 제한 기능 시도 시 "회원가입하고 이용하기" 팝업 표시 |

**게스트 모드 체험 가능/제한 기능**:

| 기능             | 사장님 모드           | 알바생 모드           | 비고                  |
| ---------------- | --------------------- | --------------------- | --------------------- |
| 대시보드 UI 확인 | ✅ 가능 (샘플 데이터) | ✅ 가능 (샘플 데이터) | 더미 계약서 3개 표시  |
| 계약서 작성 체험 | ✅ 가능 (저장 불가)   | -                     | 10단계 전체 체험 가능 |
| 계약서 미리보기  | ✅ 가능 (샘플)        | ✅ 가능 (샘플)        | 샘플 계약서 조회      |
| AI 노무사 검토   | ✅ 가능 (1회 체험)    | -                     | 샘플 결과 표시        |
| 전자서명         | ❌ 불가               | ❌ 불가               | 회원가입 유도         |
| 계약서 전송/공유 | ❌ 불가               | -                     | 회원가입 유도         |
| PDF 다운로드     | ❌ 불가               | ❌ 불가               | 회원가입 유도         |
| 채팅             | ❌ 불가               | ❌ 불가               | 회원가입 유도         |
| 폴더/휴지통 관리 | ✅ 가능 (저장 불가)   | ✅ 가능 (저장 불가)   | UI만 체험             |
| 결제             | ❌ 불가               | -                     | 회원가입 유도         |
| 경력 관리        | -                     | ✅ 가능 (샘플)        | 샘플 경력 표시        |

**게스트 모드 UI 표시**:

- 상단에 "둘러보기 중" 배너 고정 표시
- 배너 내 "회원가입하기" 버튼 포함
- 제한 기능 클릭 시 바텀시트로 회원가입 유도

#### 4.1.3 회원가입 (`/signup`)

| 항목                | 설명                                               |
| ------------------- | -------------------------------------------------- |
| **로그인 방식**     | 카카오 로그인 + Apple 로그인                       |
| **버튼 (카카오)**   | "카카오로 시작하기" (노란색 #FEE500, py-3.5)       |
| **버튼 (Apple)**    | "Apple로 시작하기" (검정색 #000000, py-3.5)        |
| **버튼 (둘러보기)** | "먼저 둘러볼게요" (텍스트 버튼, py-3)              |
| **동의 항목**       | 이용약관 동의 (필수), 개인정보처리방침 동의 (필수) |
| **가입 완료 시**    | 무료 크레딧 자동 지급 (계약서 5개, AI노무사 5개)   |
| **다음 화면**       | 역할 선택 (`/select-role`)                         |

#### 4.1.4 로그인 (`/login`)

| 항목                | 설명                                 |
| ------------------- | ------------------------------------ |
| **로그인 방식**     | 카카오 로그인 + Apple 로그인         |
| **버튼 (카카오)**   | "카카오로 시작하기" (노란색 #FEE500) |
| **버튼 (Apple)**    | "Apple로 시작하기" (검정색 #000000)  |
| **버튼 (둘러보기)** | "먼저 둘러볼게요" (텍스트 버튼)      |
| **자동 로그인**     | 앱 재접속 시 로그인 상태 유지        |
| **로그인 성공 시**  | 역할에 따른 대시보드로 이동          |

**Apple 로그인 특이사항**:

- Apple은 첫 로그인 시에만 이름을 제공 (이후에는 제공 안 함)
- 이메일 숨기기 옵션 선택 시 `privaterelay.appleid.com` 형태의 릴레이 이메일 제공
- 사업자 미등록 앱은 이메일이 `null`일 수 있음 → 코드에서 graceful 처리 필요

#### 4.1.5 역할 선택 (`/select-role`)

| 항목          | 설명                               |
| ------------- | ---------------------------------- |
| **선택지**    | "사장님이에요" / "알바생이에요"    |
| **UI**        | 큰 카드 2개 (아이콘 + 텍스트)      |
| **저장**      | 선택한 역할을 사용자 프로필에 저장 |
| **변경 가능** | 설정에서 언제든 역할 변경 가능     |

#### 4.1.6 근로자 온보딩 (`/worker/onboarding`)

| 항목            | 설명                                        |
| --------------- | ------------------------------------------- |
| **진입 조건**   | 근로자 역할 선택 후 최초 1회                |
| **Step 1**      | 휴대폰 본인인증 (PASS 또는 카카오 인증)     |
| **Step 2**      | 주민등록번호 입력 (앞 6자리 - 뒤 7자리)     |
| **Step 3**      | 급여 수령 계좌 입력 (은행 선택 + 계좌번호)  |
| **데이터 저장** | 암호화하여 DB 저장, 이후 계약서에 자동 적용 |
| **스킵 불가**   | 모든 단계 필수 완료                         |

---

### 4.2 사업자 기능

#### 4.2.1 사업자 대시보드 (`/employer`)

| 영역            | 설명                                                  |
| --------------- | ----------------------------------------------------- |
| **상단 헤더**   | 프로필 아이콘, 알림 아이콘, 크레딧 잔여량 표시        |
| **탭 메뉴**     | 대기 중 / 완료됨 / 폴더 / 휴지통                      |
| **계약서 카드** | 근로자 이름, 생성일, 상태 배지 (대기중/서명완료/만료) |
| **FAB 버튼**    | 우하단 "+" 버튼 → 새 계약서 작성                      |
| **빈 상태**     | "아직 작성한 계약서가 없어요" + CTA 버튼              |

**계약서 상태 정의**:
| 상태 | 설명 | 색상 |
|------|------|------|
| 대기 중 | 근로자 서명 대기 | 노랑 |
| 서명 완료 | 양측 서명 완료 | 초록 |
| 만료 | 7일 내 서명 없음, 폐기됨 | 회색 |

#### 4.2.2 계약서 작성 (`/employer/create`)

**Step-by-Step 입력 플로우** (총 10단계):

| Step | 필드명      | 입력 타입            | 필수 | 설명                                  |
| ---- | ----------- | -------------------- | ---- | ------------------------------------- |
| 1    | 사업장 규모 | 라디오 버튼          | Y    | "5인 미만" / "5인 이상" 선택          |
| 2    | 근로자 이름 | 텍스트               | Y    | 한글 2-10자                           |
| 3    | 시급        | 숫자 + 체크박스      | Y    | 시급 입력 + "주휴수당 포함" 체크 옵션 |
| 4    | 근무 시작일 | 날짜 선택            | Y    | 캘린더 피커                           |
| 4-1  | 근무 종료일 | 날짜 선택 + 체크박스 | N    | "종료일 없음" 체크 시 비활성화        |
| 5    | 근무 요일   | 다중 선택            | Y    | 월~일 중 선택 또는 "주 N일" 입력      |
| 6    | 근무 시간   | 시간 선택            | Y    | 시작 시간 ~ 종료 시간                 |
| 7    | 휴게 시간   | 시간 선택            | Y    | 분 단위 입력 (예: 30분, 60분)         |
| 8    | 근무 장소   | 텍스트               | Y    | 주소 입력 (주소 검색 API 연동)        |
| 9    | 업무 내용   | 텍스트 영역          | Y    | 예시 제공 (홀서빙, 주방보조 등)       |
| 10   | 급여 지급일 | 숫자 선택            | Y    | 매월 N일 (1-31)                       |

**5인 이상 사업장 추가 필드**:

- 4대 보험 가입 여부 표시
- 연장/야간/휴일 근로 수당 안내

**UI/UX 요구사항**:

- 한 화면에 1개 질문만 표시 (인지 부하 최소화)
- 상단에 진행률 표시 바 (예: 3/10)
- "이전" / "다음" 버튼 하단 고정
- 입력 검증 실패 시 인라인 에러 메시지

#### 4.2.3 계약서 미리보기 (`/employer/preview/:id`)

| 영역              | 설명                                   |
| ----------------- | -------------------------------------- |
| **계약서 본문**   | A4 비율의 계약서 미리보기 (스크롤)     |
| **사업자 서명란** | 터치하여 서명 입력 (캔버스)            |
| **하단 버튼**     | "AI 검토 요청" / "서명 완료 & 전송"    |
| **공유 옵션**     | 카카오톡 공유, 링크 복사, PDF 다운로드 |

**AI 노무사 검토 기능**:
| 항목 | 설명 |
|------|------|
| **버튼** | "AI 노무사 검토 받기" (크레딧 필요) |
| **검토 결과** | 법적 위험 요소, 개선 권장 사항 표시 |
| **결과 형식** | 항목별 ✅ 적합 / ⚠️ 주의 / ❌ 수정 필요 |
| **수정 제안** | 문제 발견 시 수정 문구 제안 |

#### 4.2.4 계약서 상세 (`/employer/contract/:id`)

| 영역              | 설명                            |
| ----------------- | ------------------------------- |
| **상태 배지**     | 현재 계약 상태 표시             |
| **계약서 본문**   | 전체 계약 내용 조회             |
| **서명 현황**     | 사업자 서명 ✅ / 근로자 서명 ⏳ |
| **액션 버튼**     | PDF 다운로드, 재전송, 수정 요청 |
| **채팅 바로가기** | 해당 근로자와 채팅 연결         |

**계약서 수정 플로우**:

1. "수정하기" 버튼 클릭
2. 기존 정보가 채워진 상태로 편집 모드 진입
3. 수정 완료 후 재서명
4. 근로자에게 수정된 계약서 재전송 (기존 계약 무효화)

---

### 4.3 근로자 기능

#### 4.3.1 근로자 대시보드 (`/worker`)

| 영역                   | 설명                                |
| ---------------------- | ----------------------------------- |
| **상단 헤더**          | 프로필 아이콘, 알림 아이콘          |
| **탭 메뉴**            | 대기 중 / 서명 완료 / 폴더 / 휴지통 |
| **계약서 카드**        | 사업장명, 시급, 근무 조건 요약      |
| **경력 관리 바로가기** | 하단 탭 또는 메뉴에서 접근          |

#### 4.3.2 계약서 확인 및 서명 (`/worker/contract/:id`)

| 영역                   | 설명                                                                                                                          |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| **상단 정보**          | 사업자 아바타, 이름, 근무장소, 상태 배지                                                                                      |
| **서명 현황 카드**     | 사업자/근로자 서명 상태 (완료: 녹색, 대기: 회색)                                                                              |
| **계약 내용**          | 사업장, 사업자, 근로자, 급여, 근무기간, 근무요일, 휴일, 근무시간, 휴게시간, 근무장소, 업무내용, 급여일 (사업자 페이지와 동일) |
| **5인 이상 추가 항목** | 연차휴가, 가산수당 (조건부 표시)                                                                                              |
| **서명란**             | 터치하여 서명 입력 (캔버스) - 서명 대기 시만 표시                                                                             |
| **PDF 다운로드**       | 양측 서명 완료 시 하단에 📄 PDF 아이콘 + 다운로드 버튼 표시                                                                   |

**서명 후 자동 처리**:

- 근로자 주민번호, 계좌번호가 계약서에 자동 삽입
- 양측 서명 완료 상태로 변경
- 사업자에게 알림톡 발송
- PDF 생성 및 보관

**서명 기한 안내**:

- 상단에 "N일 내 서명 필요" 카운트다운 표시
- 7일 초과 시 자동 폐기 안내

**PDF 다운로드 조건**:

- `contract.status === 'completed'` 또는 양측 서명 완료 시 표시
- 하단에 PDF 아이콘과 "계약서 PDF 다운로드" 버튼

#### 4.3.3 경력 관리 (`/worker/career`)

| 영역           | 설명                                  |
| -------------- | ------------------------------------- |
| **경력 목록**  | 서명 완료된 계약 기준 근무 이력 표시  |
| **표시 정보**  | 사업장명, 근무 기간, 업무 내용        |
| **경력증명서** | "경력증명서 다운로드" 버튼 → PDF 생성 |

---

### 4.4 채팅 기능

#### 4.4.1 채팅 목록 (`/employer/chat`, `/worker/chat`)

| 영역               | 설명                                  |
| ------------------ | ------------------------------------- |
| **채팅방 목록**    | 상대방 이름, 마지막 메시지, 시간 표시 |
| **읽지 않음 표시** | 안 읽은 메시지 수 배지                |
| **정렬**           | 최신 메시지 순                        |

#### 4.4.2 채팅방 상세

| 기능              | 설명                            |
| ----------------- | ------------------------------- |
| **텍스트 메시지** | 일반 텍스트 송수신              |
| **파일 첨부**     | 이미지, PDF 파일 전송 가능      |
| **계약서 연결**   | 채팅방에서 관련 계약서 바로가기 |
| **1:1만 지원**    | 그룹 채팅 미지원                |

---

### 4.5 결제 기능

#### 4.5.1 계약서 크레딧 구매 (`/pricing`)

| 상품 | 크레딧 수 | 가격     | 비고     |
| ---- | --------- | -------- | -------- |
| 기본 | 5개       | 5,000원  | -        |
| 인기 | 15개      | 12,000원 | 20% 할인 |
| 대량 | 50개      | 35,000원 | 30% 할인 |

#### 4.5.2 AI 노무사 검토 크레딧 (`/legal-review-pricing`)

| 상품 | 크레딧 수 | 가격     | 비고     |
| ---- | --------- | -------- | -------- |
| 체험 | 1개       | 2,000원  | -        |
| 기본 | 5개       | 8,000원  | 20% 할인 |
| 대량 | 20개      | 28,000원 | 30% 할인 |

#### 4.5.3 묶음 상품 (`/bundle-pricing`)

| 상품명   | 구성                    | 가격     | 할인율 |
| -------- | ----------------------- | -------- | ------ |
| 스타터팩 | 계약서 10개 + 검토 3개  | 14,000원 | 25%    |
| 사장님팩 | 계약서 30개 + 검토 10개 | 45,000원 | 35%    |

#### 4.5.4 결제 프로세스

| 단계 | 설명                                |
| ---- | ----------------------------------- |
| 1    | 상품 선택                           |
| 2    | 토스페이먼츠 결제창 호출 (간편결제) |
| 3    | 결제 완료 → 크레딧 즉시 충전        |
| 4    | 결제 내역 저장                      |

#### 4.5.5 결제 내역 (`/payment-history`)

| 표시 정보 | 설명                    |
| --------- | ----------------------- |
| 결제일시  | 결제 완료 시간          |
| 상품명    | 구매한 크레딧 상품      |
| 결제 금액 | 실결제 금액             |
| 결제 수단 | 카카오페이, 토스페이 등 |
| 영수증    | 영수증 조회 링크        |

---

### 4.6 폴더 및 휴지통 관리

#### 4.6.1 폴더 관리

| 기능           | 설명                                                       |
| -------------- | ---------------------------------------------------------- |
| 폴더 생성      | "+" 버튼으로 새 폴더 생성, 이름 입력                       |
| 폴더 이름 변경 | 폴더 길게 누르기 → 이름 변경                               |
| 폴더 삭제      | 폴더 길게 누르기 → 삭제 (내부 계약서는 기본 목록으로 이동) |
| 계약서 이동    | 계약서 길게 누르기 → 폴더 선택                             |

#### 4.6.2 휴지통

| 기능          | 설명                                |
| ------------- | ----------------------------------- |
| 삭제된 계약서 | 삭제 시 휴지통으로 이동             |
| 복원          | 휴지통에서 복원 가능                |
| 영구 삭제     | 30일 후 자동 영구 삭제              |
| 즉시 삭제     | "영구 삭제" 버튼으로 즉시 삭제 가능 |

---

### 4.7 알림

#### 4.7.1 카카오톡 알림톡 (Solapi 연동)

> **구현 상태**: ✅ 완료 (2026년 2월 4일)  
> **알림톡 제공자**: Solapi (솔라피)

**발송 시점 및 내용**:

| 발송 시점            | 수신자 | 내용                                                       | 상태 |
| -------------------- | ------ | ---------------------------------------------------------- | ---- |
| 계약서 전송 시       | 근로자 | "{사업장명}에서 근로계약서를 보냈습니다. [지금 바로 서명하기]" | ✅ 완료 |
| 계약서 수정 시       | 근로자 | "{사업장명}에서 수정된 계약서를 보냈습니다. [지금 바로 서명하기]" | ✅ 완료 |
| 서명 완료 시         | 사업자 | "OOO님이 계약서에 서명했습니다. [확인하기]"                | 🔜 예정 |
| 서명 기한 임박 (D-1) | 근로자 | "내일까지 서명하지 않으면 계약서가 폐기됩니다. [서명하기]" | 🔜 예정 |

**알림톡 발송 로직**:

| 조건                 | 동작                                  |
| -------------------- | ------------------------------------- |
| 신규 계약서 생성 + 서명 | 자동으로 알림톡 발송                  |
| 계약서 수정 + 서명   | 자동으로 알림톡 재발송                |
| 수동 재발송          | 미리보기/상세에서 버튼 클릭 시 발송   |
| 최대 재발송 횟수     | 3회 (초과 시 재발송 불가)             |
| 근로자 휴대폰 없음   | 알림톡 발송 스킵, 링크 복사로 안내    |

**환경 변수**:

| Key                          | 설명                    |
| ---------------------------- | ----------------------- |
| `SOLAPI_API_KEY`             | Solapi API 키           |
| `SOLAPI_API_SECRET`          | Solapi API 시크릿       |
| `SOLAPI_KAKAO_PF_ID`         | 카카오 채널 프로필 ID   |
| `SOLAPI_TEMPLATE_CONTRACT_SIGN` | 계약서 서명 요청 템플릿 ID |
| `SENDER_PHONE_NUMBER`        | 발신자 전화번호         |
| `ALIMTALK_ENABLED`           | 알림톡 활성화 (true/false) |

---

## 5. Non-Functional Requirements (비기능 요구사항)

### 5.1 성능 요구사항

| 항목         | 기준                    |
| ------------ | ----------------------- |
| 페이지 로딩  | 3초 이내 (3G 환경 기준) |
| API 응답     | 1초 이내                |
| PDF 생성     | 5초 이내                |
| AI 검토 응답 | 10초 이내               |

### 5.2 보안 요구사항

| 항목            | 설명                                             |
| --------------- | ------------------------------------------------ |
| 개인정보 암호화 | 주민번호, 계좌번호 AES-256 암호화 저장           |
| 통신 암호화     | 모든 통신 HTTPS (TLS 1.3)                        |
| 인증 토큰       | JWT 기반, Access Token 1시간, Refresh Token 14일 |
| 세션 관리       | 비활성 30분 후 자동 로그아웃                     |

### 5.3 접근성 요구사항

| 항목           | 기준                  |
| -------------- | --------------------- |
| 최소 터치 영역 | 44px x 44px           |
| 최소 폰트 크기 | 16px                  |
| 색상 대비      | WCAG 2.1 AA 기준 충족 |
| 스크린 리더    | 주요 기능 접근 가능   |

### 5.4 호환성 요구사항

| 항목                   | 지원 범위        |
| ---------------------- | ---------------- |
| iOS Safari             | iOS 14 이상      |
| Android Chrome         | Android 8.0 이상 |
| 삼성 인터넷            | 최신 버전        |
| 카카오톡 인앱 브라우저 | 지원 필수        |

---

## 6. Exception Handling (예외 처리)

### 6.1 네트워크 오류

| 상황             | 처리 방법                                         |
| ---------------- | ------------------------------------------------- |
| 인터넷 연결 없음 | "인터넷 연결을 확인해주세요" 토스트 + 재시도 버튼 |
| 서버 오류 (5xx)  | "일시적인 오류가 발생했습니다" + 재시도 버튼      |
| 타임아웃         | 30초 후 "요청 시간이 초과되었습니다" + 재시도     |

### 6.2 입력 오류

| 상황           | 처리 방법                                            |
| -------------- | ---------------------------------------------------- |
| 필수 필드 누락 | 해당 필드 하단에 "필수 입력 항목입니다" 표시         |
| 형식 오류      | "올바른 형식으로 입력해주세요" (예: 주민번호 13자리) |
| 최소 시급 미만 | "2026년 최저시급은 OO,OOO원입니다" 경고              |

### 6.3 비즈니스 로직 예외

| 상황               | 처리 방법                                            |
| ------------------ | ---------------------------------------------------- |
| 크레딧 부족        | "크레딧이 부족합니다" + 충전 페이지 이동 버튼        |
| 서명 기한 만료     | "서명 기한이 지났습니다. 사장님에게 다시 요청하세요" |
| 이미 서명된 계약서 | "이미 서명이 완료된 계약서입니다"                    |
| 삭제된 계약서 접근 | "삭제된 계약서입니다" + 대시보드 이동                |

### 6.4 결제 예외

| 상황      | 처리 방법                                            |
| --------- | ---------------------------------------------------- |
| 결제 취소 | "결제가 취소되었습니다" + 재시도 안내                |
| 결제 실패 | "결제에 실패했습니다. 다른 결제 수단을 시도해주세요" |
| 중복 결제 | 자동 감지 후 관리자 알림, 수동 환불 처리             |

### 6.5 빈 상태 (Empty State)

| 화면                | 메시지                        | CTA                          |
| ------------------- | ----------------------------- | ---------------------------- |
| 계약서 목록 없음    | "아직 작성한 계약서가 없어요" | "첫 계약서 작성하기"         |
| 검색 결과 없음      | "검색 결과가 없어요"          | "다른 키워드로 검색해보세요" |
| 채팅 목록 없음      | "아직 대화가 없어요"          | -                            |
| 폴더 내 계약서 없음 | "이 폴더에 계약서가 없어요"   | "계약서 이동하기"            |

---

## 7. 게스트 모드 상세 시나리오

### 7.1 시나리오: 사장님 둘러보기

1. 온보딩 → "둘러보기" 클릭
2. 역할 선택 → "사장님" 선택
3. 대시보드 진입 (샘플 계약서 3개 표시)
4. "새 계약서 작성" 클릭 → Step-by-Step 체험
5. 10단계 완료 → 미리보기 화면
6. "AI 노무사 검토" 클릭 → 샘플 검토 결과 표시
7. "서명 후 전송" 클릭 → **회원가입 유도 팝업**
8. 팝업: "계약서를 저장하고 전송하려면 회원가입이 필요해요"
   - [회원가입하기] → 회원가입 화면
   - [계속 둘러보기] → 팝업 닫기

### 7.2 시나리오: 알바생 둘러보기

1. 온보딩 → "둘러보기" 클릭
2. 역할 선택 → "알바생" 선택
3. 대시보드 진입 (샘플 계약서 2개 표시)
4. 샘플 계약서 클릭 → 계약 조건 확인 화면
5. 어려운 용어 터치 → AI 설명 팝업 (체험 가능)
6. "서명하기" 클릭 → **회원가입 유도 팝업**
7. 경력 관리 → 샘플 경력 목록 조회
8. "경력증명서 다운로드" 클릭 → **회원가입 유도 팝업**

### 7.3 샘플 데이터 정의

**사장님 대시보드 샘플 계약서**:
| 상태 | 근로자명 | 시급 | 생성일 |
|------|---------|------|--------|
| 대기 중 | 홍길동 | 12,000원 | 오늘 |
| 대기 중 | 김철수 | 11,500원 | 3일 전 |
| 서명 완료 | 이영희 | 13,000원 | 1주일 전 |

**알바생 대시보드 샘플 계약서**:
| 상태 | 사업장 | 시급 | 근무시간 |
|------|--------|------|----------|
| 대기 중 | 스타벅스 강남점 | 12,500원 | 14:00~20:00 |
| 서명 완료 | 투썸플레이스 역삼점 | 11,000원 | 09:00~15:00 |

**알바생 경력 관리 샘플**:
| 사업장 | 기간 | 업무 |
|--------|------|------|
| 이디야커피 선릉점 | 2025.06~2025.12 | 바리스타 |
| 맥도날드 삼성점 | 2024.01~2025.05 | 홀서빙 |

---

## 8. 부록

### 8.1 용어 정의

| 용어           | 정의                                                  |
| -------------- | ----------------------------------------------------- |
| 크레딧         | 서비스 내 가상 화폐. 계약서 작성 또는 AI 검토 시 사용 |
| 표준근로계약서 | 고용노동부 권장 양식을 기반으로 한 근로계약서         |
| 주휴수당       | 1주 15시간 이상 근무 시 발생하는 유급휴일 수당        |
| 전자서명       | 법적 효력이 있는 디지털 서명                          |

### 8.2 법적 근거

- 근로기준법 (2026년 개정안 적용)
- 전자서명법
- 개인정보보호법

---

---

## 📝 Amendment 1: UI/UX 개선 사항 (2026년 1월 24일)

> **버전**: 1.1  
> **변경 사유**: 사용자 피드백 기반 네비게이션 및 대시보드 레이아웃 개선

### A1.1 헤더 네비게이션 메뉴 추가

#### A1.1.1 기존 → 변경

| 항목      | 기존                | 변경                                             |
| --------- | ------------------- | ------------------------------------------------ |
| 헤더 좌측 | 프로필 이모지 (😊)  | **삭제** (불필요)                                |
| 헤더 우측 | 알림 아이콘, 크레딧 | 알림 아이콘, 크레딧, **햄버거 메뉴 아이콘 (☰)** |

#### A1.1.2 메뉴 시트 (MenuSheet) 신규 정의

햄버거 메뉴 클릭 시 우측에서 슬라이드하는 사이드시트 또는 바텀시트

**메뉴 구조:**

```
┌─────────────────────────────────────┐
│ 😊 김사장님                          │
│ example@kakao.com                   │
├─────────────────────────────────────┤
│ 👤 프로필 설정        → /profile     │
│ 💳 크레딧 충전        → /pricing     │
│ 📋 결제 내역          → /payment-history │
│ 🗑️ 휴지통            → 대시보드 휴지통 섹션 │
├─────────────────────────────────────┤
│ 📄 이용약관           → /terms       │
│ 🔒 개인정보처리방침    → /privacy     │
├─────────────────────────────────────┤
│ 🚪 로그아웃           → /auth/signout │
└─────────────────────────────────────┘
```

| 메뉴 항목        | 설명                         | 이동 경로                                             |
| ---------------- | ---------------------------- | ----------------------------------------------------- |
| 프로필 설정      | 내 정보 조회/수정, 역할 변경 | `/profile`                                            |
| 크레딧 충전      | 계약서/AI검토 크레딧 구매    | `/pricing`                                            |
| 결제 내역        | 결제 이력 조회               | `/payment-history`                                    |
| 휴지통           | 삭제된 계약서 관리           | 대시보드 내 휴지통 섹션 스크롤 또는 `/employer/trash` |
| 이용약관         | 서비스 이용약관              | `/terms`                                              |
| 개인정보처리방침 | 개인정보 처리방침            | `/privacy`                                            |
| 로그아웃         | 세션 종료                    | `/auth/signout`                                       |

---

### A1.2 사업자 대시보드 레이아웃 변경

#### A1.2.1 기존 → 변경

| 항목      | 기존                                    | 변경                                                   |
| --------- | --------------------------------------- | ------------------------------------------------------ |
| 레이아웃  | 탭 기반 (대기중 / 완료 / 폴더 / 휴지통) | **단일 스크롤 화면에 2개 섹션**                        |
| 탭 바     | 상단 고정 탭 4개                        | **삭제**                                               |
| 폴더 관리 | 별도 탭                                 | "완료된 계약서" 섹션 우측 상단 **작은 버튼 [📁 폴더]** |
| 휴지통    | 별도 탭                                 | 메뉴 시트에서 접근                                     |

#### A1.2.2 변경된 대시보드 레이아웃

```
┌─────────────────────────────────────┐
│          싸인해주세요      [🔔] [☰] │   ← 헤더 (좌측 이모지 제거)
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 💎 크레딧 5개          [충전 →] │ │   ← 크레딧 카드
│ └─────────────────────────────────┘ │
│                                     │
│ 📋 대기중인 계약서 (2)               │   ← 섹션 1
│ ┌───────────────────────────────┐   │
│ │ 홍길동 | 12,000원 | 🟡 대기중  │   │
│ └───────────────────────────────┘   │
│ ┌───────────────────────────────┐   │
│ │ 김철수 | 11,000원 | 🟡 대기중  │   │
│ └───────────────────────────────┘   │
│                                     │
│ ✅ 완료된 계약서 (3)     [📁 폴더]   │   ← 섹션 2 + 폴더 버튼
│ ┌───────────────────────────────┐   │
│ │ 이영희 | 13,000원 | 🟢 완료   │   │
│ └───────────────────────────────┘   │
│ ┌───────────────────────────────┐   │
│ │ 박민수 | 10,500원 | 🟢 완료   │   │
│ └───────────────────────────────┘   │
│                                     │
│                            [+]      │   ← FAB 버튼
└─────────────────────────────────────┘
```

#### A1.2.3 새로운 UI 요소

| 요소                 | 설명                                               |
| -------------------- | -------------------------------------------------- |
| 크레딧 카드          | 대시보드 상단에 보유 크레딧 표시 + 충전 바로가기   |
| 대기중인 계약서 섹션 | status = 'pending' 계약서 목록                     |
| 완료된 계약서 섹션   | status = 'completed' 계약서 목록                   |
| 폴더 버튼            | 완료 섹션 우측, 클릭 시 `/employer/folders`로 이동 |
| 섹션 카운트          | 각 섹션 제목 옆 계약서 개수 표시                   |

---

### A1.3 프로필 페이지 상세 정의

#### A1.3.1 화면: `/profile`

```
┌─────────────────────────────────────┐
│ ←  프로필 설정                       │
├─────────────────────────────────────┤
│                                     │
│ ┌───────────────────────────────┐   │
│ │      [👤 아바타 이미지]        │   │
│ │        김사장님               │   │
│ │   example@kakao.com          │   │
│ └───────────────────────────────┘   │
│                                     │
│ 내 정보                             │
│ ┌───────────────────────────────┐   │
│ │ 이름         김사장님      [→] │   │
│ ├───────────────────────────────┤   │
│ │ 연락처       010-1234-5678 [→] │   │
│ └───────────────────────────────┘   │
│                                     │
│ 역할 변경                           │
│ ┌───────────────────────────────┐   │
│ │ 현재: 사장님             [→]  │   │
│ │ 알바생으로 전환 가능           │   │
│ └───────────────────────────────┘   │
│                                     │
│ 앱 설정                             │
│ ┌───────────────────────────────┐   │
│ │ 알림 설정                 [→] │   │
│ └───────────────────────────────┘   │
│                                     │
│ 계정                                │
│ ┌───────────────────────────────┐   │
│ │ 🚪 로그아웃                    │   │
│ └───────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

#### A1.3.2 프로필 페이지 기능

| 기능        | 설명                                      |
| ----------- | ----------------------------------------- |
| 이름 수정   | 텍스트 입력으로 이름 변경                 |
| 연락처 수정 | 전화번호 변경 (선택)                      |
| 역할 변경   | 사장님 ↔ 알바생 전환, ConfirmSheet로 확인 |
| 알림 설정   | 푸시 알림 on/off                          |
| 로그아웃    | 세션 종료 후 홈으로 이동                  |

---

### A1.4 근로자 대시보드 레이아웃 변경

사업자와 동일하게 적용:

- 탭 제거
- "대기중인 계약서", "완료된 계약서" 2개 섹션
- 폴더 관리는 메뉴 시트 또는 완료 섹션 버튼으로 접근

---

> **Amendment 1 끝**

---

## 📝 Amendment 2: 게스트 모드 및 환영 메시지 (2026년 1월 24일)

> **버전**: 1.2  
> **변경 사유**: 게스트 모드 지원 및 로그인 후 환영 메시지 개선

### A2.1 로그인 후 환영 메시지

#### A2.1.1 역할 선택 페이지 (`/select-role`) 변경

카카오 로그인 후 역할 선택 페이지에서 사용자 닉네임을 표시합니다.

**기존:**

```
반가워요! 👋
어떻게 사용할 건가요?
```

**변경:**

```
{닉네임}님, 환영합니다! 👋
어떻게 사용할 건가요?
```

- 닉네임은 카카오 `user_metadata.name` 또는 `user_metadata.full_name`에서 가져옴
- 닉네임이 없는 경우 기존 "반가워요!" 표시

---

### A2.2 게스트 모드 개선

#### A2.2.1 문제점

- 기존: 둘러볼게요 → role 선택 → 로그인 페이지로 리다이렉트
- 원인: `(protected)` 폴더의 layout에서 인증 체크

#### A2.2.2 해결 방안

1. **쿠키 기반 게스트 상태 저장**: localStorage 대신 쿠키 사용 (서버에서 읽기 가능)
2. **Layout 게스트 체크**: `(protected)/layout.tsx`에서 게스트 쿠키 확인 후 인증 스킵
3. **샘플 데이터 제공**: 게스트 모드에서 데모용 계약서 데이터 표시

#### A2.2.3 게스트 모드 플로우

```
둘러볼게요 클릭
    ↓
역할 선택 (사장님/알바생)
    ↓
쿠키에 게스트 상태 저장
    ↓
해당 대시보드로 이동
    ↓
샘플 데이터 표시
```

#### A2.2.4 게스트 모드 샘플 데이터

**사업자 모드:**
| 근로자명 | 시급 | 상태 |
|---------|------|------|
| 홍길동 | 9,860원 | 대기중 |
| 김철수 | 10,000원 | 완료 |

**근로자 모드:**
| 사장님 | 시급 | 상태 | D-Day |
|--------|------|------|-------|
| 김사장 | 9,860원 | 대기중 | D-2 |
| 이사장 | 10,500원 | 완료 | - |

---

### A2.3 게스트 모드 제한사항

게스트 모드에서는 다음 기능이 **비활성화**됩니다:

- 실제 계약서 작성 및 저장
- 결제/크레딧 충전
- 프로필 수정
- 채팅
- AI 리뷰 (1회 무료 제외)

---

> **Amendment 2 끝**

---

## 📝 Amendment 3: 폴더 모달 및 닉네임 표시 (2026년 1월 24일)

> **버전**: 1.3  
> **변경 사유**: UX 개선 - 폴더 관리를 모달로, 헤더에 닉네임 표시

### A3.1 폴더 관리 모달

#### A3.1.1 변경 사항

- **기존**: 폴더 관리 버튼 클릭 → `/employer/folders` 페이지로 이동
- **변경**: 폴더 관리 버튼 클릭 → 대시보드에서 모달로 바로 CRUD

#### A3.1.2 모달 UI

```
┌─────────────────────────────────────┐
│ ← 폴더 관리                      X  │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 📋 미분류          12개 계약서  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 내 폴더 (3)                         │
│ ┌─────────────────────────────────┐ │
│ │ 🔵 카페 알바     5개   ✏️ 🗑️  │ │
│ │ 🟢 마트         3개   ✏️ 🗑️  │ │
│ │ 🟡 편의점       2개   ✏️ 🗑️  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [+ 새 폴더 만들기]                   │
└─────────────────────────────────────┘
```

#### A3.1.3 색상 선택 기능

폴더 생성/수정 시 8가지 색상 중 선택 가능:

- 블루 (#3B82F6)
- 그린 (#22C55E)
- 옐로우 (#EAB308)
- 오렌지 (#F97316)
- 레드 (#EF4444)
- 퍼플 (#A855F7)
- 핑크 (#EC4899)
- 그레이 (#6B7280)

**주의**: 현재 DB에 `color` 컬럼이 없어 인덱스 기반으로 색상 할당.
추후 마이그레이션으로 `folders.color` 컬럼 추가 필요.

---

### A3.2 헤더 닉네임 표시

#### A3.2.1 변경 사항

- **기존**: 헤더 중앙에 "싸인해주세요" 로고 표시
- **변경**: 헤더 중앙에 "{닉네임}님 👋" 표시

#### A3.2.2 Header 컴포넌트

```typescript
<Header
  userName={profile.name}  // 새 prop
  credits={credits}
  ...
/>
```

---

### A3.3 게스트 모드 계약서 상세

#### A3.3.1 샘플 계약서 데이터

게스트 모드에서 계약서 카드 클릭 시 상세 페이지에서 샘플 데이터 표시.

| ID       | 근로자명 | 시급     | 상태   | 업무     |
| -------- | -------- | -------- | ------ | -------- |
| sample-1 | 김민수   | 10,030원 | 완료   | 바리스타 |
| sample-2 | 이서연   | 11,000원 | 대기중 | 홀서빙   |
| sample-3 | 박지훈   | 12,000원 | 작성중 | 계산원   |

---

> **Amendment 3 끝**

---

## 📝 Amendment 4: 대시보드 UI 개편 (2026년 1월 24일)

> **버전**: 1.4  
> **변경 사유**: 대시보드 UX 개선 - 통합 리스트, 편집 모드, 폴더 이동

### A4.1 대시보드 레이아웃 변경

#### A4.1.1 헤더 구조

```
┌─────────────────────────────────────┐
│ 환영합니다                   🔔  ☰  │
└─────────────────────────────────────┘
```

#### A4.1.2 닉네임 + 크레딧

```
김사장님님 👋

🎟️ 5건 남음
```

#### A4.1.3 새 계약서 버튼

```
┌─────────────────────────────────────┐
│        + 새 계약서 작성              │
└─────────────────────────────────────┘
```

- FAB 제거, 큰 파란색 버튼으로 변경

---

### A4.2 계약서 카드 UI

#### A4.2.1 카드 구조

```
┌──────────────────────────────────────────────┐
│ 🟡  박지훈                [임시저장] [수정] > │
│     GS25 잠실역점                            │
└──────────────────────────────────────────────┘
```

#### A4.2.2 상태별 뱃지

| 상태      | 뱃지        | 색상 |
| --------- | ----------- | ---- |
| draft     | 임시저장    | 회색 |
| pending   | ⏱ 서명 대기 | 주황 |
| completed | ✓ 완료      | 초록 |

#### A4.2.3 수정 버튼

- draft, pending 상태에서만 표시
- 파란색 버튼

---

### A4.3 편집 모드

#### A4.3.1 편집 모드 헤더

```
┌─────────────────────────────────────┐
│ ✕  0개 선택됨              전체 선택 │
├─────────────────────────────────────┤
│ [↕ 최신순] [📁 이동] [🗑️ 삭제]     │
└─────────────────────────────────────┘
```

#### A4.3.2 정렬 옵션

- 최신순: 생성일 기준 내림차순
- 가게별: work_location 기준 오름차순

#### A4.3.3 다중 선택

- 카드 좌측에 체크박스 표시
- 선택된 카드: 파란 ring 테두리

---

### A4.4 폴더 이동 모달

```
┌─────────────────────────────────────┐
│ 폴더로 이동                      X  │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ + 새 폴더 만들기                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 📄 전체 (폴더 해제)                  │
│ 📁 카페 (기존 폴더)                  │
└─────────────────────────────────────┘
```

#### A4.4.1 기능

- 기존 폴더 선택: 선택된 계약서들 이동
- 전체 (폴더 해제): folder_id = null
- 새 폴더 만들기: 폴더 생성 후 바로 이동

---

### A4.5 휴지통 정책

- 삭제 시 status = 'deleted'로 변경
- deleted_at 타임스탬프 기록
- 30일 후 자동 영구 삭제 (DB Function/Cron)

---

> **Amendment 4 끝**

---

## 📝 Amendment 5: 사업장 규모 선택 UI 개선 (2026년 1월 24일)

> **버전**: 1.5  
> **변경 사유**: 계약서 작성 Step 1 UX 개선

### A5.1 텍스트 변경

| 요소        | 기존                           | 변경                                 |
| ----------- | ------------------------------ | ------------------------------------ |
| 질문        | "사업장 규모가 어떻게 되나요?" | "사장님, 가게에 직원이 몇 명인가요?" |
| 부가 설명   | "4대보험 적용 여부가 달라져요" | "사장님 본인도 포함해서 알려주세요"  |
| 옵션 1 라벨 | "5인 미만"                     | "5명 미만"                           |
| 옵션 1 설명 | "4대보험 선택 가입"            | "소규모 가게 (1~4명)"                |
| 옵션 2 라벨 | "5인 이상"                     | "5명 이상"                           |
| 옵션 2 설명 | "4대보험 의무 가입"            | "중소규모 이상 (5명~)"               |

---

### A5.2 아이콘 변경

| 옵션     | 기존                  | 변경               |
| -------- | --------------------- | ------------------ |
| 5명 미만 | 라디오 버튼 (체크 원) | 건물 아이콘 (🏢)   |
| 5명 이상 | 라디오 버튼 (체크 원) | 사람들 아이콘 (👥) |

**선택 시 스타일:**

- 미선택: 회색 배경 + 회색 아이콘
- 선택됨: 파란 배경 + 흰색 아이콘 + 파란 테두리

---

### A5.3 안내 박스 추가

선택에 따라 하단에 안내 메시지 표시:

| 선택     | 색상 | 메시지                                                                                     |
| -------- | ---- | ------------------------------------------------------------------------------------------ |
| 5명 미만 | 초록 | "ℹ 소규모 가게는 간단하게 진행됩니다 ✓"                                                    |
| 5명 이상 | 노랑 | "ℹ 5명 이상이면 수당을 더 자세히 적어야 해요<br>걱정마세요, 제가 자동으로 계산해드릴게요!" |

---

> **Amendment 5 끝**

---

## 📝 Amendment 6: 급여 형태 선택 UI 개선 (2026년 1월 24일)

> **버전**: 1.6  
> **변경 사유**: 시급/월급 선택 기능 추가 및 주휴수당 UI 카드형으로 개선

### A6.1 화면 변경 (Step 3 급여 형태 선택)

#### 질문 변경

| 항목 | 기존                    | 변경                       |
| ---- | ----------------------- | -------------------------- |
| 질문 | "시급을 얼마로 할까요?" | "급여 형태를 선택해주세요" |

#### 급여 형태 선택 추가

| 옵션 | 아이콘    | 설명         |
| ---- | --------- | ------------ |
| 시급 | 💳 (지갑) | 시간당 급여  |
| 월급 | 💵 (지폐) | 월 정액 급여 |

#### 입력 필드 변경

| 급여 형태 | 라벨                               | 입력 스타일 |
| --------- | ---------------------------------- | ----------- |
| 시급      | "2026년 최저시급은 10,360원이에요" | 둥근 박스   |
| 월급      | "월 급여를 입력해주세요"           | 둥근 박스   |

### A6.2 주휴수당 체크박스 카드형 UI

기존 작은 체크박스 → 큰 카드형 체크박스로 변경

**카드 내용:**

- 체크박스 아이콘 (원형)
- 제목: "위 시급에 주휴수당이 포함되어 있다면 체크해주세요"
- 설명: "주휴수당이란? 일주일에 15시간 이상 근무하는 직원에게 지급하는 유급휴일 수당이에요"
- 체크 시 추가 안내: "✓ 이 경우 최저시급은 12,432원 이상이어야 해요"

**스타일:**

- 미선택: 회색 테두리
- 선택됨: 파란 테두리 + 파란 배경

### A6.3 최저시급 업데이트

| 항목             | 기존     | 변경         |
| ---------------- | -------- | ------------ |
| 2026년 최저시급  | 10,030원 | **10,360원** |
| 주휴수당 포함 시 | 없음     | **12,432원** |

### A6.4 데이터 필드 추가

| 필드          | 타입                  | 설명      |
| ------------- | --------------------- | --------- |
| `wageType`    | 'hourly' \| 'monthly' | 급여 형태 |
| `monthlyWage` | number \| null        | 월급 금액 |

---

> **Amendment 6 끝**

---

## 📝 Amendment 7: 근무일 설정 UI 개선 (2026년 1월 24일)

> **버전**: 1.7  
> **변경 사유**: 근무일 설정 UX 개선 (주 N일 / 특정 요일 토글 방식)

### A7.1 화면 변경 (Step 5 근무일 설정)

#### 질문 변경

| 항목 | 기존                    | 변경                        |
| ---- | ----------------------- | --------------------------- |
| 질문 | "무슨 요일에 일하나요?" | "근무일을 어떻게 정할까요?" |

#### 선택 방식 변경

| 기존                           | 변경                                |
| ------------------------------ | ----------------------------------- |
| 요일 선택 → "또는" → 숫자 입력 | **"주 N일" / "특정 요일"** 2열 토글 |

### A7.2 주 N일 모드

- **부제목**: "주 몇 일 근무하나요?"
- **UI**: 칩 버튼 7개 (주1일 ~ 주7일)
- **레이아웃**: 4열 + 3열 (2행)

### A7.3 특정 요일 모드

- **부제목**: "근무할 요일을 선택하세요"
- **UI**: 정사각형 칩 버튼 7개 (월 ~ 일)
- **레이아웃**: 7열 (1행)
- **선택 표시**: "선택: 월, 화, 수, 목, 금" 하단 표시

---

> **Amendment 7 끝**

---

## 📝 Amendment 8: 주소 검색 Daum 우편번호 연동 (2026년 1월 24일)

> **버전**: 1.8  
> **변경 사유**: 다음(Daum) 우편번호 서비스 연동으로 정확한 주소 입력 지원

### A8.1 기능 변경 (Step 8 근무지 입력)

#### 기존 → 변경

| 기존             | 변경                        |
| ---------------- | --------------------------- |
| 텍스트 직접 입력 | **다음 우편번호 검색** 팝업 |

### A8.2 UI 흐름

1. "주소 검색" 버튼 클릭
2. 다음 우편번호 검색창 표시 (embed 방식)
3. 주소 선택 시 자동 입력
4. 상세주소 추가 입력 가능

### A8.3 연동 API

- **서비스**: Daum Postcode Service
- **스크립트**: `//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js`
- **방식**: embed (페이지 내 삽입)

---

> **Amendment 8 끝**

---

## 📝 Amendment 9: 임금 지급일 UI 개선 (2026년 1월 24일)

> **버전**: 1.9  
> **변경 사유**: 당월/익월 지급 선택 및 날짜 그리드 UI로 개선

### A9.1 화면 변경 (Step 10 임금 지급일)

#### 질문 변경

| 기존                     | 변경                      |
| ------------------------ | ------------------------- |
| "월급은 언제 줄 건가요?" | "임금은 언제 지급하나요?" |

### A9.2 지급 시기 선택 추가

| 옵션          | 설명             |
| ------------- | ---------------- |
| **당월 지급** | 근무한 달에 지급 |
| **익월 지급** | 다음 달에 지급   |

### A9.3 말일 지급 체크박스

- **UI**: 원형 체크박스 + "말일 지급" 라벨
- **동작**: 체크 시 날짜 그리드 비활성화

### A9.4 날짜 그리드

- **범위**: 1일 ~ 28일 (4주 기준)
- **레이아웃**: 7열 × 4행 그리드
- **선택 스타일**: 파란 배경 + 흰색 텍스트

### A9.5 데이터 필드 추가

| 필드               | 타입                            | 설명           |
| ------------------ | ------------------------------- | -------------- |
| `paymentTiming`    | 'current_month' \| 'next_month' | 당월/익월 지급 |
| `isLastDayPayment` | boolean                         | 말일 지급 여부 |

---

> **Amendment 9 끝**

---

## 📝 Amendment 10: 업종별 업무 키워드 추천 (2026년 1월 24일)

> **버전**: 1.10  
> **변경 사유**: 업종 선택 + 업종별 업무 키워드 추천 기능 추가

### A10.1 업종 선택 기능

| 업종          | 아이콘 |
| ------------- | ------ |
| 식당          | 🍽️     |
| 카페          | ☕     |
| 편의점        | 🏪     |
| 소매점        | 🛍️     |
| 미용실/네일샵 | 💇     |
| 사무직        | 💼     |

### A10.2 업종별 추천 키워드

| 업종   | 키워드 예시                                        |
| ------ | -------------------------------------------------- |
| 식당   | 홀 서빙 및 고객 응대, 주방 조리 및 음식 준비, ...  |
| 카페   | 음료 제조 (바리스타), 디저트 제조 및 플레이팅, ... |
| 편의점 | 계산 및 주문 접수, 상품 진열 및 정리, ...          |

### A10.3 UI 구성

1. **업종 표시 영역**: 아이콘 + 라벨 + "업종 변경" 버튼
2. **업종 선택 모달**: 바텀시트로 6개 업종 표시
3. **키워드 태그**: 토글 가능한 칩 버튼
4. **추가 입력**: 텍스트 영역으로 추가 업무 내용 입력

### A10.4 데이터 필드 추가

| 필드           | 타입           | 설명        |
| -------------- | -------------- | ----------- |
| `businessType` | string \| null | 선택된 업종 |

---

> **Amendment 10 끝**

---

## 📝 Amendment 11: 휴대폰 번호 매칭 본인 확인 (2026년 1월 25일)

> **버전**: 1.11  
> **변경 사유**: MVP 무료 본인 확인 방식 도입

### A11.1 개요

유료 SMS 인증 대신 **휴대폰 번호 매칭**으로 본인 확인을 구현합니다.

| 방식                 | 비용                  | 보안 수준 | MVP 적합성      |
| -------------------- | --------------------- | --------- | --------------- |
| SMS 인증 (알리고 등) | 유료 (건당 10~20원)   | 높음      | ❌              |
| PASS 본인인증        | 유료 (건당 100~200원) | 매우 높음 | ❌              |
| **휴대폰 번호 매칭** | **무료**              | 중간      | **✅ MVP 적합** |

### A11.2 플로우

```
[사장님 계약서 작성]
1. 근로자 이름 입력
2. 근로자 휴대폰 번호 입력 (신규)
         ↓
[카카오톡/SMS로 링크 전송]
         ↓
[근로자가 링크 클릭]
         ↓
[본인 확인 화면]
📱 "본인 확인이 필요해요"
   등록된 번호: 010-****-5678
   [휴대폰 번호 입력]
         ↓
[번호 일치 확인]
- 불일치: "계약서에 등록된 번호와 일치하지 않아요"
- 일치: 계약서 전체 보기로 이동
         ↓
[계약서 확인 + 서명하기 버튼]
         ↓
[서명 시 카카오 로그인 유도]
"✨ 3초만에 로그인하고 경력으로 저장하세요"
         ↓
[카카오 로그인 → 서명 완료]
         ↓
🎉 "첫 경력이 저장됐어요!"
   - 회원가입 혜택 안내
   - "3초만에 가입하기" 버튼
```

### A11.3 보안 고려사항

| 항목               | 설명                                                  |
| ------------------ | ----------------------------------------------------- |
| 마스킹             | 전체 번호 대신 일부만 힌트로 표시 (010-\*\*\*\*-5678) |
| 시도 제한          | 추후 구현: 5회 실패 시 일정 시간 차단                 |
| 카카오 로그인 필수 | 서명 시 로그인 필요, 익명 서명 불가                   |

### A11.4 데이터 필드

#### Step 2 변경: 근로자 이름 → 근로자 정보

| 필드          | 타입   | 필수 | 설명                               |
| ------------- | ------ | ---- | ---------------------------------- |
| `workerName`  | string | Y    | 근로자 이름 (한글 2-10자)          |
| `workerPhone` | string | Y    | 근로자 휴대폰 번호 (010-0000-0000) |

### A11.5 UI 변경 사항

#### Step 2 화면

**기존:**

```
근로자 이름이 어떻게 되나요?
[이름 입력]
```

**변경:**

```
근로자 정보를 입력해주세요

이름
[이름 입력]

휴대폰 번호
[010-0000-0000]

📱 이 번호로 계약서 서명 링크가 전송돼요
```

#### 서명 링크 접근 시 화면 (신규)

```
📱 본인 확인이 필요해요

계약서에 등록된 휴대폰 번호를 입력해주세요

등록된 번호: 010-****-5678

[_______________]

[확인]
```

#### 서명 완료 화면 (변경)

```
🎉 계약이 완료됐어요!

이 계약서가 첫 경력으로 저장돼요

┌─────────────────────────────────┐
│ ✨ 회원가입하면 이런 혜택이 있어요  │
│ • 내 경력 자동 관리              │
│ • 계약서 PDF 다운로드            │
│ • 다음 계약 정보 자동 입력        │
└─────────────────────────────────┘

[3초만에 가입하기]

나중에 할게요
```

---

> **Amendment 11 끝**

---

## 📝 Amendment 12: UX 개선 및 프리미엄 기능 (2026년 1월 25일)

> **버전**: 1.12  
> **변경 사유**: 사용자 피드백 기반 UX 개선

### A12.1 휴게시간 없음 옵션

Step 7 휴게시간 선택에 "없음(0분)" 옵션이 추가되었습니다.

| 옵션      | 표시        |
| --------- | ----------- |
| 0분       | 없음        |
| 30분      | 30분        |
| 60분      | 60분        |
| 직접 입력 | 사용자 정의 |

---

### A12.2 업종 선택 자동 모달

Step 9 업종 선택에서 업종이 선택되지 않은 경우 자동으로 선택 모달이 열립니다.

| 상태        | 동작                              |
| ----------- | --------------------------------- |
| 업종 미선택 | 컴포넌트 마운트 시 모달 자동 열림 |
| 업종 선택됨 | 버튼 클릭으로 변경 가능           |

---

### A12.3 홈 버튼 및 임시저장 기능

#### 계약서 작성 페이지

- 우측 상단에 홈 버튼 추가
- 클릭 시 종료 확인 바텀시트 표시
- "작성 중인 내용은 자동으로 저장돼요" 안내

#### 대시보드

- 임시저장된 계약서가 있으면 바텀시트로 안내
- "이어서 작성하기" 또는 "새로 시작하기" 선택

---

### A12.4 크레딧 표시 개선

대시보드에 두 가지 크레딧을 분리하여 표시합니다.

| 크레딧 종류      | 아이콘 | 스타일                  |
| ---------------- | ------ | ----------------------- |
| 계약서 크레딧    | 💎     | cyan/blue 그라데이션    |
| AI 노무사 크레딧 | ⚡️     | amber/yellow 그라데이션 |

---

### A12.5 법적 문서 페이지

| 페이지           | 경로       | 접근 경로        |
| ---------------- | ---------- | ---------------- |
| 이용약관         | `/terms`   | 메뉴 시트        |
| 개인정보처리방침 | `/privacy` | 메뉴 시트        |
| 환불정책         | `/refund`  | 메뉴 시트 (신규) |

---

### A12.6 AI 노무사 버튼 프리미엄 디자인

계약서 미리보기 페이지의 AI 검토 버튼이 프리미엄 스타일로 변경되었습니다.

**디자인 요소:**

- 그라데이션 배경 (amber → orange)
- Shimmer 애니메이션 효과
- ⚖️ 법적 저울 아이콘
- "PRO" 배지

---

### A12.7 Coming Soon 기능 안내

현재 개발 중인 기능에 대해 친절한 안내 메시지를 표시합니다.

| 기능          | 메시지                                                             |
| ------------- | ------------------------------------------------------------------ |
| PDF 다운로드  | "📄 PDF 다운로드 기능을 준비하고 있어요! 조금만 기다려 주세요 🙏"  |
| 카카오톡 공유 | "💬 카카오톡 공유 기능을 준비하고 있어요! 조금만 기다려 주세요 🙏" |

---

### A12.8 공유 링크 바텀시트

계약서 서명 후 공유 링크를 바텀시트로 표시합니다.

**구성:**

- 공유 가능한 링크 표시
- 복사 버튼
- "카카오톡이나 문자로 링크를 보내주세요" 안내
- 완료 버튼

---

### A12.9 AI 리뷰 및 저장 흐름 개선

#### 서명 전 AI 검토 가능

- 계약서 저장 없이 미리 AI 검토 가능
- contractData를 직접 전달하여 검토

#### 저장하고 공유하기 통합

- 서명 완료 후 "저장하고 공유하기 📤" 버튼 클릭
- 바로 공유 링크 생성 및 바텀시트 표시
- 별도 리다이렉트 없이 같은 화면에서 공유 완료

---

> **Amendment 12 끝**

---

## 📝 Amendment 13: 대시보드 편집 기능 (2026년 1월 25일)

> **버전**: 1.13  
> **변경 사유**: 사업자/근로자 대시보드 편집 기능 강화

### 13.1 사업자 대시보드 편집 기능

#### 계약서 삭제 (휴지통)

| 항목        | 내용                                            |
| ----------- | ----------------------------------------------- |
| 삭제 방식   | Soft Delete (status='deleted', deleted_at 기록) |
| 휴지통 접근 | 폴더 탭에서 "🗑️ 휴지통" 탭                      |
| 복구        | 휴지통에서 선택 후 "복구"                       |
| 영구 삭제   | 휴지통에서 선택 후 "영구 삭제"                  |

#### 폴더 탭 UI

| 항목      | 내용                                        |
| --------- | ------------------------------------------- |
| 표시 조건 | 폴더가 1개 이상 OR 삭제된 계약서 1개 이상   |
| 탭 구성   | [전체] [폴더1] [폴더2] ... [🗑️ 휴지통] [⚙️] |
| 폴더 색상 | DB 저장 지원 (color 컬럼)                   |

### 13.2 근로자 대시보드 숨기기 기능

#### 숨기기 기능

| 항목              | 내용                                         |
| ----------------- | -------------------------------------------- |
| 대상              | 체결 완료된 계약서만                         |
| 숨기기 방식       | worker_hidden_contracts 테이블에 레코드 추가 |
| 숨김 탭 표시 조건 | 숨긴 계약서가 1개 이상일 때만                |
| 복구              | 숨김 탭에서 선택 후 "다시 보기"              |

#### 숨김 탭 UI

| 항목           | 내용                          |
| -------------- | ----------------------------- |
| 탭 구성        | [전체 (N)] [👁️ 숨김 (N)]      |
| 숨김 날짜 표시 | "오늘 숨김", "3일 전 숨김" 등 |

---

> **Amendment 13 끝**

---

## 📝 Amendment 14: 공유 링크 UX 개선 (2026년 1월 25일)

> **버전**: 1.14  
> **변경 사유**: 카카오톡 링크 공유 문제 해결 및 사용자 경험 개선

### 14.1 공유 링크 단축

#### 문제점

- 기존 URL `/contract/sign/[token]`이 카카오톡에서 전체 하이퍼링크로 인식되지 않음
- 사용자가 링크 복사 후 공유 시 `/`까지만 클릭 가능

#### 해결 방안

| 항목     | 기존                       | 변경           |
| -------- | -------------------------- | -------------- |
| 공유 URL | `/contract/sign/abc123...` | `/s/abc123...` |
| URL 길이 | 약 60자                    | 약 40자        |

**기술 구현:**

- `/s/[token]` 라우트 생성 (Next.js redirect 사용)
- 실제 서명 페이지로 자동 리다이렉트

---

### 14.2 공유 바텀시트 UI 개선

#### 저장 완료 후 UI 변경

```
[저장하고 공유하기] 클릭
         ↓
공유 바텀시트 열림
         ↓
링크 복사 후 바텀시트 닫기
         ↓
┌─────────────────────────────────────┐
│                                     │
│         ✅ 저장 완료!               │
│                                     │
│   계약서가 저장되었어요              │
│   근로자가 서명하면 알림을 드릴게요   │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │       홈으로 돌아가기            │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 카카오톡 공유 가이드 강화

```
┌─────────────────────────────────────┐
│ 근로자에게 공유하기               ✕  │
├─────────────────────────────────────┤
│                                     │
│ ⚠️ 아래 링크를 복사해서 근로자에게   │
│ 직접 카카오톡으로 보내주세요!        │
│ (파란색 굵은 글씨)                   │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ https://signplease.vercel.app/  │ │
│ │ s/abc123...                     │ │
│ │                                 │ │
│ │           [링크 복사하기]        │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 💡 링크만 단독으로 보내야            │
│   클릭이 잘 돼요                    │
│                                     │
└─────────────────────────────────────┘
```

---

### 14.3 근로자 서명 플로우 변경

#### 기존 플로우 (문제)

```
링크 클릭 → 번호 인증 → 서명 시도 → "로그인 필요" 오류
```

#### 변경된 플로우

```
링크 클릭
    ↓
[번호 인증 화면]
010-****-5678 힌트 표시
번호 입력 → 일치 확인
    ↓
[계약서 확인 화면]
계약 조건 카드 표시
"서명하기" 버튼
    ↓
[로그인 상태 체크]
- 미로그인: "카카오로 3초 만에 로그인하고 서명하기"
- 로그인됨: "서명하고 계약하기 ✍️"
    ↓
[카카오 로그인] (미로그인 시)
자동으로 worker 역할 설정
서명 페이지로 복귀
    ↓
[서명 입력]
    ↓
🎉 서명 완료
```

---

### 14.4 계약서 상세 공유 기능

#### 변경 사항

| 항목        | 기존                    | 변경               |
| ----------- | ----------------------- | ------------------ |
| 재전송 버튼 | 카카오톡 공유 함수 호출 | 공유 바텀시트 열기 |
| 공유 UI     | 별도 (Coming Soon)      | 미리보기와 동일    |

---

> **Amendment 14 끝**

---

## 📝 Amendment 15: 민감정보 보안 열람 기능 (2026년 1월 25일)

> **버전**: 1.15  
> **변경 사유**: 사업자가 4대보험 신고를 위해 근로자 주민번호/계좌 열람 필요

### 15.1 기능 개요

#### 문제점

사업자가 근로자의 주민등록번호와 계좌번호를 4대보험 신고에 사용해야 하지만,
보안상 민감정보를 무제한으로 노출하면 안 됨.

#### 해결책

- **기본 마스킹**: 평소에는 `******-*******` 형태로 표시
- **클릭 시 전체 표시**: 필요할 때만 전체 정보 확인
- **10초 후 자동 숨김**: 방치 시 자동 마스킹 복귀
- **열람 로그 기록**: 누가, 언제, 어떤 정보를 열람했는지 기록

### 15.2 사용자 스토리

```
사업자로서
완료된 계약서에서 근로자의 주민등록번호와 계좌번호를 확인하여
4대보험 신고를 할 수 있다
```

### 15.3 기능 명세

#### 접근 조건

| 항목          | 조건                                                        |
| ------------- | ----------------------------------------------------------- |
| 사용자        | 계약서 작성자 (employer_id = 로그인 사용자)                 |
| 계약 상태     | `completed` (서명 완료)                                     |
| 민감정보 존재 | `worker_ssn_encrypted` 또는 `worker_account_encrypted` 존재 |

#### 표시 정보

| 항목         | 마스킹 상태               | 전체 표시                 |
| ------------ | ------------------------- | ------------------------- |
| 주민등록번호 | `******-*******`          | `990101-1234567`          |
| 급여 계좌    | `신한은행 ****-****-****` | `신한은행 110-123-456789` |

#### 보안 기능

| 기능      | 설명                                                    |
| --------- | ------------------------------------------------------- |
| 열람 로그 | 열람 시 user_id, contract_id, 시간, IP, User-Agent 기록 |
| 자동 숨김 | 10초 카운트다운 후 자동 마스킹 복귀                     |
| 수동 숨김 | "숨기기" 버튼으로 즉시 마스킹                           |
| 권한 검증 | employer_id 일치 여부 서버에서 검증                     |

### 15.4 플로우

```
사업자가 완료된 계약서 상세 페이지 접속
    ↓
"근로자 정보 (4대보험용)" 섹션 표시
주민등록번호: ******-*******
급여 계좌: 신한은행 ****-****-****
    ↓
[🔓 정보 보기 (10초간)] 버튼 클릭
    ↓
API 호출 → 열람 로그 기록 → 복호화 데이터 반환
    ↓
주민등록번호: 990101-1234567
급여 계좌: 신한은행 110-123-456789
"🔒 10초 후 자동 숨김" 카운트다운 표시
    ↓
10초 경과 또는 "숨기기" 버튼 클릭
    ↓
다시 마스킹 상태로 복귀
```

---

> **Amendment 15 끝**

---

## 📝 Amendment 16: 서명 완료 페이지 UX 개선 (2026년 1월 25일)

> **버전**: 1.16  
> **변경 사유**: 서명 완료 후 버튼이 없어 사용자가 계약서를 확인할 수 없음

### 16.1 문제점

서명 완료 후 표시되는 화면:

```
✅
이미 서명된 계약서예요
계약서 확인이 필요하면
앱에 로그인해주세요
```

→ **버튼이 없어서 다음 행동을 할 수 없음**

### 16.2 해결책

사용자 상태에 따른 적절한 CTA 버튼 제공:

| 사용자 상태            | 메인 버튼             | 이동 경로               |
| ---------------------- | --------------------- | ----------------------- |
| 본인 계약서 (로그인됨) | "계약서 확인하기 📄"  | `/worker/contract/{id}` |
| 다른 로그인 사용자     | "내 계약서 목록 보기" | `/worker`               |
| 비로그인               | "카카오로 로그인하기" | `/login`                |
| 공통 (보조)            | "홈으로 가기"         | `/`                     |

### 16.3 사용자 스토리

```
근로자로서
서명 완료 후 바로 계약서 내용을 확인하여
서명이 정상적으로 저장되었는지 확인할 수 있다
```

---

> **Amendment 16 끝**

---

## 📝 Amendment 17: 사업장 관리 및 계약서 작성 플로우 개선 (2026년 1월 27일)

> **버전**: 1.17  
> **변경 사유**: 사업장 선택/관리 기능 추가 및 계약서 작성 플로우 개선

### 17.1 사업장 관리 기능

#### 기능 개요

사업자가 여러 사업장(지점)을 운영하는 경우를 지원하기 위해 사업장 관리 기능을 추가합니다.

| 기능           | 설명                                        |
| -------------- | ------------------------------------------- |
| 사업장 등록    | 사업장명 + 주소를 등록                      |
| 사업장 선택    | 계약서 작성 시 기존 사업장 선택 가능        |
| 주소 자동 연동 | 선택한 사업장의 주소가 근무장소로 자동 설정 |

### 17.2 계약서 작성 Step 변경

#### 기존 플로우 (10단계)

```
Step 1: 사업장 규모
Step 2: 근로자 이름/연락처
Step 3: 급여
Step 4: 근무 기간
Step 5: 근무 요일
Step 6: 근무 시간
Step 7: 휴게 시간
Step 8: 근무 장소 ← 삭제됨
Step 9: 업무 내용
Step 10: 급여일
```

#### 변경된 플로우 (9단계)

```
Step 1: 사업장 선택/등록 ← 신규
Step 2: 사업장 규모
Step 3: 근로자 이름/연락처
Step 4: 급여
Step 5: 근무 기간
Step 6: 근무 요일
Step 7: 근무 시간
Step 8: 휴게 시간
Step 9: 업무 내용 + 급여일 (통합)
```

### 17.3 Step 1 사업장 선택 화면

```
┌─────────────────────────────────────┐
│ ←  1/9                              │
├─────────────────────────────────────┤
│                                     │
│   어떤 사업장에서 근무하나요?        │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🏢 커피하우스 강남점              │ │
│ │    서울시 강남구 테헤란로 123     │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🏢 커피하우스 역삼점              │ │
│ │    서울시 강남구 역삼로 456      │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐ │
│   + 새 사업장 등록                  │
│ └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘ │
│                                     │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │           다음                   │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 17.4 새 사업장 등록 UI

```
┌─────────────────────────────────────┐
│ ← 새 사업장 등록                     │
├─────────────────────────────────────┤
│                                     │
│ 사업장 이름                          │
│ ┌─────────────────────────────────┐ │
│ │ 커피하우스 선릉점                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 사업장 주소                          │
│ ┌─────────────────────────────────┐ │
│ │ 서울시 강남구 선릉로...   🔍     │ │
│ └─────────────────────────────────┘ │
│ (Daum 우편번호 검색 연동)            │
│                                     │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │      등록하고 선택하기           │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 17.5 계약서 화면 사업장명 표시

모든 계약서 관련 화면에 사업장명을 표시합니다:

| 화면                 | 표시 위치           |
| -------------------- | ------------------- |
| 계약서 미리보기      | 계약서 항목 상단    |
| employer 계약서 상세 | 계약서 항목 상단    |
| worker 계약서 상세   | 계약서 상세 보기 내 |
| 근로자 서명 페이지   | 계약서 항목 상단    |

### 17.6 카카오톡 공유 메시지 변경

#### 기존 메시지

```
📝 근로계약서가 도착했어요
사업주에서 {근로자명}님에게 근로계약서를 보냈어요.
```

#### 변경된 메시지

```
📝 근로계약서가 도착했어요
{사업장명}에서 {근로자명}님에게 근로계약서를 보냈어요.
```

---

> **Amendment 17 끝**

---

## Amendment 18: MVP 기능 정리 및 법적 요건 준수 (2026년 1월 27일)

### 18.1 고객센터 변경

#### 기존

- 1:1 실시간 채팅 UI 제공 (미구현 상태)

#### 변경

- **이메일 문의**로 변경
- 이메일: `lemonmilkceo@gmail.com`
- 클릭 시 기본 메일 앱 열림

### 18.2 미출시 기능 안내

MVP에서 제외된 기능들을 사용자에게 안내:

| 기능            | 위치            | 안내 방식                                            |
| --------------- | --------------- | ---------------------------------------------------- |
| 채팅            | 하단 네비게이션 | 토스트: "채팅 기능은 곧 출시 예정이에요!"            |
| 경력증명서 발급 | 경력 페이지     | 토스트: "경력증명서 발급 기능은 곧 출시 예정이에요!" |

### 18.3 온보딩 문구 변경

| 이전              | 이후             |
| ----------------- | ---------------- |
| "10분이면 끝나요" | "1분이면 끝나요" |

- 실제 계약서 작성 소요 시간 반영
- SEO 메타데이터도 동일하게 변경

### 18.4 법적 필수 항목 추가 (근로기준법 제17조)

#### 추가된 항목

| 항목         | 표시 방식                              | 적용 대상  |
| ------------ | -------------------------------------- | ---------- |
| **휴일**     | 근무요일 기반 자동 계산                | 전체       |
| **연차휴가** | "근로기준법 제60조에 따라 부여"        | 5인 이상만 |
| **가산수당** | "연장·야간·휴일 근로 시 50% 이상 가산" | 5인 이상만 |

#### 휴일 계산 로직

| 입력 방식      | 예시           | 휴일 표시 |
| -------------- | -------------- | --------- |
| 특정 요일 선택 | 월,화,수,목,금 | 토, 일    |
| 주 N일 선택    | 주 5일         | 주 2일    |

#### 적용 위치

- PDF 계약서
- 계약서 미리보기
- 사업자 계약서 상세
- 근로자 계약서 상세
- 근로자 서명 페이지

### 18.5 법적 근거

| 법조항            | 내용                                                                             |
| ----------------- | -------------------------------------------------------------------------------- |
| 근로기준법 제17조 | 근로조건 서면 명시 의무 (임금, 소정근로시간, 휴일, 연차휴가, 취업장소, 업무내용) |
| 근로기준법 제55조 | 주휴일 (1주 15시간 이상 근무 시 유급휴일)                                        |
| 근로기준법 제56조 | 연장·야간·휴일 근로 가산수당 (5인 이상)                                          |
| 근로기준법 제60조 | 연차유급휴가 (5인 이상)                                                          |

---

> **Amendment 18 끝**

---

## 📝 Amendment 19: 사업장 수정/삭제 기능 (2026년 1월 28일)

> **버전**: 1.20  
> **변경 사유**: 사업장 관리 편의성 강화

### 19.1 사업장 관리 기능 추가

#### 사업장 목록 화면 변경

**기존:**

```
┌─────────────────────────────────────┐
│ 🏪  커피하우스 강남점             ✓  │
│     서울시 강남구 테헤란로...        │
└─────────────────────────────────────┘
```

**변경:**

```
┌─────────────────────────────────────┐
│ 🏪  커피하우스 강남점             ✓  │
│     서울시 강남구 테헤란로...        │
│ ─────────────────────────────────── │
│    [ 수정 ]         [ 삭제 ]        │
└─────────────────────────────────────┘
```

### 19.2 사업장 수정 기능

| 항목               | 설명                                |
| ------------------ | ----------------------------------- |
| **트리거**         | 사업장 카드의 "수정" 버튼 클릭      |
| **UI**             | 바텀시트 (등록과 동일한 형식)       |
| **수정 가능 항목** | 사업장명, 주소 (Daum Postcode 검색) |
| **저장**           | DB 업데이트 후 목록 갱신            |

### 19.3 사업장 삭제 기능

| 항목            | 설명                                       |
| --------------- | ------------------------------------------ |
| **트리거**      | 사업장 카드의 "삭제" 버튼 클릭             |
| **확인**        | 삭제 확인 바텀시트 표시                    |
| **경고 메시지** | "이 사업장을 삭제하시겠어요?"              |
| **삭제 후**     | 목록에서 제거, 선택된 상태였으면 선택 해제 |

### 19.4 삭제 확인 UI

```
┌─────────────────────────────────────┐
│ ─────  (핸들)                       │
│                                     │
│  사업장 삭제                          │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ ⚠️  커피하우스 강남점          │    │  ← 빨간 배경
│  │     이 사업장을 삭제하시겠어요?  │    │
│  └─────────────────────────────┘    │
│                                     │
│  [ 취소 ]         [ 삭제 ]           │
│   (회색)           (빨강)            │
│                                     │
└─────────────────────────────────────┘
```

---

> **Amendment 19 끝**

---

## 📝 Amendment 20: AI 노무사 무료화 (2026년 1월 28일)

> **버전**: 1.21  
> **변경 사유**: AI 노무사 검토 기능을 무료로 전환

### 20.1 AI 노무사 크레딧 정책 변경

#### 기존 정책

| 크레딧 종류      | 초기 지급 | 가격 |
| ---------------- | --------- | ---- |
| 계약서 크레딧    | 5개       | 유료 |
| AI 노무사 크레딧 | 5개       | 유료 |

#### 변경된 정책

| 크레딧 종류    | 초기 지급  | 가격     |
| -------------- | ---------- | -------- |
| 계약서 크레딧  | 5개        | 유료     |
| AI 노무사 검토 | **무제한** | **무료** |

### 20.2 영향 받는 화면

| 화면            | 변경 내용                                              |
| --------------- | ------------------------------------------------------ |
| 대시보드 헤더   | AI 노무사 크레딧 표시 제거                             |
| 결제 페이지     | AI 검토 크레딧 상품 제거, "무료로 이용 가능" 안내 추가 |
| 계약서 미리보기 | 크레딧 차감 없이 AI 검토 가능                          |

### 20.3 결제 상품 변경

#### AI 노무사 검토 크레딧 (삭제됨)

~~| 상품 | 크레딧 수 | 가격 |~~
~~|------|----------|------|~~
~~| 체험 | 1개 | 2,000원 |~~
~~| 기본 | 5개 | 8,000원 |~~
~~| 대량 | 20개 | 28,000원 |~~

**변경**: AI 노무사 검토는 무료로 무제한 이용 가능

---

> **Amendment 20 끝**

---

## 📝 Amendment 21: 이용약관 전자서명 법적 효력 명시 (2026년 1월 28일)

> **버전**: 1.22  
> **변경 사유**: 전자서명의 법적 효력을 명확히 안내

### 21.1 이용약관 구조 변경

#### 기존 구조

```
제1조 (목적)
제2조 (서비스 내용)
제3조 (면책 조항) ← 기존 면책조항
제4조 (이용자의 의무)
...
```

#### 변경된 구조

```
제1조 (목적)
제2조 (서비스 내용)
제3조 (전자서명의 법적 효력) ← 신규 추가
제4조 (면책 조항) ← 번호 변경
제5조 (이용자의 의무) ← 번호 변경
...
```

### 21.2 제3조 전자서명의 법적 효력 (신규)

**법적 근거**:

- 「근로기준법」 제17조 제2항
- 「전자서명법」 제3조

**핵심 내용**:
본 서비스를 통해 작성된 전자 근로계약서는 **서면 근로계약서와 동일한 법적 효력**을 가집니다.

### 21.3 제4조 면책조항 수정 내용

**변경된 항목**:

- "전자서명의 법적 효력에 관한 사항"
- → "특정 기관(법원, 행정기관 등)에서 개별 사안에 따라 전자문서를 인정하지 않는 경우"

---

> **Amendment 21 끝**

---

## 📝 Amendment 22: PC방 및 스타트업 업종 추가 (2026년 1월 28일)

> **버전**: 1.23  
> **변경 사유**: 업종 선택 옵션 확장

### 22.1 업종 목록 확장

#### 기존 업종 (6개)

| 업종          | 아이콘 |
| ------------- | ------ |
| 식당          | 🍽️     |
| 카페          | ☕     |
| 편의점        | 🏪     |
| 소매점        | 🛍️     |
| 미용실/네일샵 | 💇     |
| 사무직        | 💼     |

#### 추가된 업종 (2개)

| 업종         | 아이콘 | 추천 키워드                                                                                                                                      |
| ------------ | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| **PC방**     | 🖥️     | 고객 응대 및 좌석 안내, 음식/음료 서빙 및 조리, 계산 및 충전 접수, PC 및 주변기기 관리, 매장 청소 및 정리, 회원 관리 및 이벤트 안내              |
| **스타트업** | 🚀     | 기획 및 프로젝트 관리, 마케팅 및 콘텐츠 제작, 개발 및 기술 지원, 디자인 및 UI/UX, 고객 응대 및 CS 업무, 사무 행정 및 총무, 데이터 분석 및 리서치 |

### 22.2 적용 위치

| 화면               | 설명                                     |
| ------------------ | ---------------------------------------- |
| Step 9 (업무 내용) | 업종 선택 바텀시트에 PC방, 스타트업 추가 |
| Step 10 (급여일)   | 업종 표시에 PC방, 스타트업 추가          |

---

> **Amendment 22 끝**

---

## 📝 Amendment 23: 퇴사 처리 및 근무이력서 발급 기능 (2026년 1월 31일)

> **버전**: 1.24  
> **변경 사유**: 근로자 퇴사일 입력 및 정확한 경력 관리 기능 추가

### 23.1 기능 개요

#### 문제점

- 근로자가 퇴사하더라도 실제 퇴사일을 입력할 방법이 없었음
- 경력증명서에 정확한 근무 기간이 반영되지 않음
- "경력증명서"라는 명칭이 법적 효력을 암시하여 오해 소지

#### 해결책

- 근로자 계약서 상세에서 "퇴사 처리" 버튼으로 퇴사일 입력
- 근무이력서(Work History Summary)로 명칭 변경
- 면책 문구 추가로 법적 책임 명확화

### 23.2 퇴사 처리 기능

#### 접근 조건

| 항목      | 조건                               |
| --------- | ---------------------------------- |
| 사용자    | 근로자 (worker_id = 로그인 사용자) |
| 계약 상태 | `completed` (서명 완료)            |

#### 퇴사 처리 플로우

```
근로자가 계약서 상세 페이지 접속
    ↓
"퇴사 처리" 버튼 표시 (완료된 계약서만)
    ↓
[🚪 퇴사 처리] 버튼 클릭 (퇴사일 미입력 시)
[✅ 퇴사일 수정] 버튼 클릭 (퇴사일 입력됨 시)
    ↓
퇴사일 입력 BottomSheet 열림
    ↓
날짜 선택 및 검증
- 시작일 이전 불가
- 미래 날짜 불가
    ↓
"퇴사일 저장" 버튼 클릭
    ↓
✅ 저장 완료 토스트
```

#### 퇴사일 입력 BottomSheet UI

```
┌─────────────────────────────────────┐
│ ─────  (핸들)                       │
│                                     │
│  퇴사 처리                           │
│                                     │
│  ℹ️ 퇴사일을 입력하면 근무이력서에    │
│     정확한 근무 기간이 반영돼요       │
│                                     │
│  퇴사일 선택                         │
│  ┌─────────────────────────────┐    │
│  │ 📅  2026-01-31              │    │
│  └─────────────────────────────┘    │
│                                     │
│  [퇴사일 저장]                       │
│                                     │
│  ──────── 또는 ────────             │
│                                     │
│  [퇴사일 삭제] (퇴사일 있을 때만)      │
│                                     │
└─────────────────────────────────────┘
```

### 23.3 내 경력 페이지 개선

#### 퇴사일 미입력 안내 배너

```
┌─────────────────────────────────────┐
│ 💡 퇴사일 미입력 안내                │
│                                     │
│    N개 계약서에 퇴사일이 입력되지    │
│    않았어요. 퇴사일을 입력하면 더    │
│    정확한 근무이력서를 발급받을      │
│    수 있어요.                        │
│                                     │
│    카드를 눌러 퇴사 처리하세요        │
│                                     │
└─────────────────────────────────────┘
```

- 조건: 무기한 계약 + 퇴사일 미입력인 계약서가 있을 때만 표시

#### 계약서 카드 UI 변경

```
┌──────────────────────────────────────────────┐
│ 🏢 커피하우스 강남점                          │
│ 2025.03.01 ~ 현재            [근무 중] >     │
│                                              │
└──────────────────────────────────────────────┘
```

- 카드 전체 클릭 가능 (cursor-pointer)
- 우측에 상태 배지 + 화살표 아이콘
- hover 시 배경색 변경

#### 상태 배지 종류

| 상태          | 조건                             | 배지 색상           |
| ------------- | -------------------------------- | ------------------- |
| 근무 중       | 무기한 + 퇴사일 없음             | 초록 (bg-green-100) |
| 퇴사 완료     | resignation_date 있음            | 파랑 (bg-blue-100)  |
| 계약 종료     | end_date < 오늘                  | 회색 (bg-gray-100)  |
| 퇴사일 미입력 | 무기한 + 퇴사일 없음 (안내 필요) | 주황 (bg-amber-100) |

### 23.4 근무이력서 (구 경력증명서) 변경

#### 명칭 변경

| 기존                      | 변경                     |
| ------------------------- | ------------------------ |
| 경력증명서                | **근무이력서**           |
| Certificate of Employment | **Work History Summary** |

#### 면책 문구 추가

```
┌─────────────────────────────────────┐
│       📋 근 무 이 력 서              │
│       Work History Summary          │
│                                     │
│  싸인해주세요 계약 정보 기반 참고용   │
│  문서                                │
├─────────────────────────────────────┤
│                                     │
│  ... 근무 이력 내용 ...              │
│                                     │
├─────────────────────────────────────┤
│  💡 구직 활동 시 참고자료로 활용할   │
│     수 있어요. 공식 증명이 필요하면  │
│     해당 사업장에 요청해주세요.       │
├─────────────────────────────────────┤
│  발급: 싸인해주세요 | 전자근로계약서  │
│        플랫폼                        │
└─────────────────────────────────────┘
```

### 23.5 사업자 화면 영향

#### 계약서 상세 페이지

- 근무기간에 퇴사일 표시 추가
- 형식: `2025.03.01 ~ 2026.01.31 (퇴사)`

### 23.6 데이터 우선순위 로직

근무 종료일을 결정할 때 다음 우선순위 적용:

| 우선순위 | 필드               | 설명                                               |
| -------- | ------------------ | -------------------------------------------------- |
| 1순위    | `resignation_date` | 근로자가 직접 입력한 실제 퇴사일                   |
| 2순위    | `end_date`         | 계약서에 명시된 종료일 (오늘 이전이면 종료로 간주) |
| 3순위    | `null`             | 무기한 계약, 현재 진행 중                          |

---

> **Amendment 23 끝**

---

## 📝 Amendment 24: 서명 증적 정보 저장 (2026년 1월 31일)

> **버전**: 1.24  
> **변경 사유**: 법적 효력 강화를 위한 서명 시점 증적 정보 저장

### 24.1 개요

근로기준법에 따른 법적 효력 강화를 위해 서명 시 다음 정보를 자동 저장합니다:

- **언제**: 서명 시점 (timestamp)
- **어디서**: IP 주소
- **어떤 기기로**: User-Agent (브라우저/기기 정보)

### 24.2 저장되는 증적 정보

| 항목      | 컬럼명       | 예시                                        |
| --------- | ------------ | ------------------------------------------- |
| 서명 시점 | `signed_at`  | 2026-01-31T14:30:00.000Z                    |
| IP 주소   | `ip_address` | 211.234.56.78                               |
| 기기 정보 | `user_agent` | Mozilla/5.0 (iPhone; CPU iPhone OS 17_0...) |

### 24.3 법적 근거

| 법률       | 조항   | 내용                       |
| ---------- | ------ | -------------------------- |
| 근로기준법 | 제17조 | 근로조건 명시 및 교부 의무 |
| 전자서명법 | 제3조  | 전자서명의 효력            |

### 24.4 기술 구현

서버 액션에서 HTTP 헤더를 통해 자동 수집됩니다:

- `x-forwarded-for` 또는 `x-real-ip` → IP 주소
- `user-agent` → 기기/브라우저 정보

### 24.5 비용

- 추가 비용: **없음** (이미 HTTP 요청에 포함된 정보 활용)

---

> **Amendment 24 끝**

---

## 📝 Amendment 25: 카카오 알림톡 구현 - Solapi (2026년 2월 4일)

> **버전**: 1.25  
> **변경 사유**: 계약서 서명 요청 알림톡 자동 발송 기능 구현

### 25.1 개요

계약서 작성/수정 완료 시 근로자에게 카카오 알림톡으로 서명 요청 링크를 자동 발송합니다.

**핵심 기능**:

| 기능              | 설명                                           |
| ----------------- | ---------------------------------------------- |
| 자동 발송         | 계약서 생성/수정 + 서명 완료 시 자동 발송      |
| 수동 재발송       | 미리보기/상세 페이지에서 버튼으로 재발송       |
| 재발송 제한       | 최대 3회까지 재발송 가능                       |
| 발송 현황 표시    | 성공/실패 상태, 수신 번호, 재발송 횟수 표시    |

### 25.2 알림톡 제공자 선택

**Aligo → Solapi 전환 이유**:

| 항목        | Aligo                    | Solapi                 |
| ----------- | ------------------------ | ---------------------- |
| IP 정책     | 고정 IP 필수 (화이트리스트) | 모든 IP 허용 가능      |
| Vercel 호환 | ❌ 불가 (동적 IP)         | ✅ 호환                |
| SDK         | REST API만               | Node.js SDK 제공       |

### 25.3 알림톡 템플릿

**계약서 서명 요청 (template_id: KA01TP260204072926920Rzt7krqePL7)**:

```
📝 근로계약서가 도착했어요!

{사업장명}에서 {근로자명}님에게 
근로계약서를 보냈습니다.

아래 버튼을 눌러 계약 내용을 확인하고
서명해 주세요.

[지금 바로 서명하기]
```

### 25.4 발송 로직

**발송 조건 및 동작**:

```
1. 신규 계약서 생성 + 사장 서명
   ↓ 근로자 휴대폰 번호가 있으면
   ↓ 알림톡 자동 발송
   ↓ notification_logs 기록

2. 계약서 수정 + 사장 서명
   ↓ 근로자 휴대폰 번호가 있으면
   ↓ 알림톡 자동 발송 (수정 안내)
   ↓ notification_logs 기록

3. 수동 재발송 (미리보기/상세)
   ↓ 재발송 횟수 확인 (최대 3회)
   ↓ 초과 시 에러 반환
   ↓ 미만 시 알림톡 발송
```

### 25.5 UI 변경 사항

**근로자 연락처 입력 (Step2)**:
- "이 번호로 카카오 알림톡이 전송돼요" 안내 추가
- "(알림톡 발송용)" 라벨 추가

**미리보기 공유 바텀시트**:
- 알림톡 발송 성공/실패 상태 표시
- 마스킹된 수신 번호 표시 (010-****-5678)
- 재발송 횟수 표시 (1/3)
- 재발송 버튼

**계약서 상세 페이지**:
- pending 상태: "알림톡" 버튼 (재발송 횟수 표시)
- completed 상태: "공유" 버튼 숨김 (불필요)

**카카오톡 SDK 공유 버튼 제거**:
- 알림톡 + 직접 링크 공유로 단순화
- 기존 카카오 공유 아이콘 제거

### 25.6 데이터 로깅

**notification_logs 테이블**:

| 컬럼            | 타입      | 설명                           |
| --------------- | --------- | ------------------------------ |
| id              | uuid      | PK                             |
| user_id         | uuid      | 발송자 (사업자)                |
| contract_id     | uuid      | 관련 계약서                    |
| recipient_phone | text      | 수신자 휴대폰 번호             |
| type            | text      | alimtalk / sms / push          |
| template_code   | text      | 템플릿 ID                      |
| status          | text      | sent / failed / pending        |
| message_id      | text      | Solapi 메시지 ID               |
| error           | text      | 에러 메시지 (실패 시)          |
| created_at      | timestamp | 발송 시각                      |

### 25.7 버그 수정

**근로자 서명 후 UI 깜박임 수정**:
- 증상: 서명 완료 후 "카카오로 로그인하기" 화면이 잠깐 표시됨
- 원인: router.refresh()로 서버 컴포넌트 재렌더링 시 타이밍 이슈
- 해결: router.refresh() 제거, 클라이언트 상태로 완료 화면 관리

---

> **Amendment 25 끝**

---

## 📝 Amendment 26: 결제 시스템 보안 및 UX 강화 (2026년 2월 9일)

> **버전**: 1.26  
> **변경 사유**: 결제 시스템 전반적인 보안 강화 및 사용자 경험 개선

### 26.1 보안 강화

#### 금액 조작 방지

| 항목 | 기존 | 변경 |
|------|------|------|
| 금액 검증 | 클라이언트 전달 금액 사용 | DB 저장 금액과 비교 후 DB 금액 사용 |
| 검증 시점 | 토스 API 호출 후 | 토스 API 호출 전 선검증 |

**검증 로직:**
```
클라이언트 요청 (amount=10000)
    ↓
DB에서 order_id로 결제 정보 조회
    ↓
[검증] 요청 금액 vs DB 저장 금액
    ↓
불일치 시 → 에러 반환 (amount_mismatch)
일치 시 → 토스 API 호출 (DB 금액 사용)
```

#### Race Condition 방지

| 항목 | 기존 | 변경 |
|------|------|------|
| 크레딧 지급 | 개별 UPDATE 쿼리 | 원자적 DB 함수 호출 |
| 동시 접근 | 중복 지급 가능 | Row Lock으로 방지 |

**DB 함수:** `process_payment_completion()`
- `FOR UPDATE SKIP LOCKED`로 Row 잠금
- 상태 업데이트 + 크레딧 지급 트랜잭션 처리
- 이미 처리된 결제는 `FALSE` 반환

#### Rate Limiting

| API | 제한 | 기간 |
|-----|------|------|
| `/api/payment/prepare` | 5회 | 1분 |
| `/api/refund/request` | 3회 | 1분 |

**구현:**
- `lib/utils/rate-limiter.ts` 유틸리티
- In-Memory LRU Cache (Serverless 환경 고려)
- 429 응답 시 X-RateLimit 헤더 포함

### 26.2 DB 스키마 강화

#### payments 테이블

| 변경 항목 | 설명 |
|----------|------|
| `UNIQUE(order_id)` | 중복 주문 방지 |
| `CHECK(status)` | 유효 상태값만 허용 |
| 인덱스 | user_id, status, created_at |

#### RLS 정책

| 테이블 | 정책 |
|--------|------|
| payments | SELECT/INSERT/UPDATE 본인만 |
| credits | SELECT 본인만 |
| credit_transactions | SELECT 본인만 |

### 26.3 환불 로직 개선

#### 크레딧 사용량 계산 정확도 향상

| 기존 | 변경 |
|------|------|
| 현재 잔액 기반 추정 | 결제 이후 차감 내역 합산 |

**계산 로직:**
```
1. 해당 결제로 지급된 크레딧 조회 (reference_id = payment_id)
2. 결제 시점 이후 차감된 크레딧 합계
3. 환불 가능 크레딧 = 지급 - 사용
```

### 26.4 UI/UX 개선

#### 결제 결과 피드백

URL 파라미터로 결제 결과 전달:
- `?success=true` → "결제가 완료됐어요! 🎉"
- `?error=payment_not_found` → "결제 정보를 찾을 수 없어요"
- `?error=amount_mismatch` → "결제 금액이 일치하지 않아요"
- `?warning=credit_pending` → "결제 완료! 크레딧은 곧 지급돼요"

#### 에러 메시지 상세화

| 기존 | 변경 |
|------|------|
| "결제에 실패했어요" | 에러 유형별 맞춤 메시지 |
| HTTP 429 미처리 | "요청이 너무 많아요. 잠시 후 다시 시도해주세요" |

#### 접근성 강화

| 요소 | 변경 |
|------|------|
| 결제창 닫기 버튼 | `aria-label="결제창 닫기"` 추가 |
| SVG 아이콘 | `aria-hidden="true"` 추가 |
| 상품 선택 버튼 | `aria-label`, `aria-pressed` 추가 |

### 26.5 기술 구현

#### Rate Limiter 유틸리티

```typescript
// lib/utils/rate-limiter.ts
interface RateLimitResult {
  allowed: boolean;
  remaining: number;
  resetAt: number;
}

function checkRateLimit(
  key: string, 
  maxRequests: number, 
  windowMs: number
): RateLimitResult

function getRateLimitKey(
  prefix: string, 
  identifier: string
): string
```

#### 보안 DB 함수

| 함수 | 용도 | 실행 주기 |
|------|------|----------|
| `process_payment_completion()` | 원자적 결제 완료 | 결제 승인 시 |
| `expire_old_credits()` | 만료 크레딧 정리 | pg_cron 매일 |
| `cleanup_pending_payments()` | 미완료 결제 정리 | pg_cron 매시간 |

---

> **Amendment 26 끝**

---

## 📝 Amendment 27: 환불 수수료 시스템 도입 (2026년 2월 9일)

> **버전**: 1.27  
> **변경 사유**: 환불 남용 방지 및 운영 비용 보전을 위한 수수료 정책 도입

### 27.1 환불 수수료 정책

#### 수수료율

| 조건 | 수수료율 | 비고 |
|------|----------|------|
| 기본 | **10%** | 환불 기본 금액에서 차감 |
| 7일 이내 미사용 | **0%** (면제) | 결제 후 7일 이내 + 크레딧 미사용 |

#### 최소 환불 금액

- 수수료 차감 후 환불 금액이 **1,000원 미만**인 경우 환불 불가

### 27.2 법적 근거

| 법률 | 조항 | 적용 |
|------|------|------|
| 전자상거래법 | 제17조 | 7일 이내 청약철회권 보장 |
| 콘텐츠산업진흥법 | 제27조 | 디지털 콘텐츠 환불 기준 |

#### 7일 수수료 면제 근거

- 전자상거래법에 따른 청약철회권 보장 (7일 이내 전액 환불)
- 단, 이미 사용한 크레딧은 디지털 콘텐츠 제공 완료로 청약철회 제외

### 27.3 영향 받는 화면

| 화면 | 변경 사항 |
|------|----------|
| RefundRequestSheet | 수수료 안내 섹션 추가, 결과 화면에 수수료 상세 표시 |
| 환불정책 페이지 | 수수료율, 면제조건, 최소 환불 금액 명시 |
| API 응답 | baseRefundAmount, feeAmount, feeRate, isNoFeeApplied 추가 |

### 27.4 환불 금액 계산

```
1. 환불 기본 금액 = (미사용 크레딧 ÷ 총 크레딧) × 결제 금액
2. 수수료 적용 여부 판단
   - 결제 후 7일 이내 AND 크레딧 미사용 → 수수료 0%
   - 그 외 → 수수료 10%
3. 수수료 금액 = 환불 기본 금액 × 수수료율
4. 최종 환불 금액 = 환불 기본 금액 - 수수료 금액
5. 최소 금액 검증
   - 최종 환불 금액 < 1,000원 → 환불 불가
```

### 27.5 UI 표시 예시

#### 환불 요청 시 안내

```
💰 환불 수수료 안내
• 결제 후 7일 이내 + 크레딧 미사용 시: 수수료 0%
• 그 외의 경우: 환불 금액의 10% 수수료 적용
• 최소 환불 금액: 1,000원
```

#### 환불 완료 결과

```
✅ 환불 요청이 완료됐어요

환불 크레딧: 5건
환불 기본 금액: ₩4,500
환불 수수료 (10%): -₩450
───────────────────
환불 예정 금액: ₩4,050
```

또는 수수료 면제 시:

```
✅ 환불 요청이 완료됐어요

환불 크레딧: 5건
환불 기본 금액: ₩4,500
환불 수수료 (0%): 면제
───────────────────
환불 예정 금액: ₩4,500

🎉 7일 이내 미사용 환불로 수수료가 면제됐어요
```

### 27.6 DB 스키마 변경

`refund_requests` 테이블에 다음 컬럼 추가:

| 컬럼 | 타입 | 설명 |
|------|------|------|
| base_refund_amount | integer | 수수료 차감 전 환불 금액 |
| fee_rate | numeric(5,4) | 적용된 수수료율 (0.10 = 10%) |
| fee_amount | integer | 수수료 금액 |

---

> **Amendment 27 끝**
